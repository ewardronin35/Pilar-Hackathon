<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilar-eLearn</title>
    <link rel="icon" href="images/pilarLogo.ico" type="image/x-icon">
    <link rel="shortcut icon" href="images/pilarLogo.ico" type="image/x-icon">
        
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #7209b7;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --success: #4ade80;
            --warning: #f9c74f;
            --danger: #ef476f;
            --light: #f8f9fa;
            --dark: #212529;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text: #f8fafc;
            /* Light Mode - Modern Blue Gradient & White Theme */
            --bg-light: #f8fafc;
            --text-light: #1e3a8a;
            --card-bg-light: #ffffff;
            --primary-light: #2563eb;
            --secondary-light: #60a5fa;
            --accent-light: #93c5fd;
            --gradient-light-1: #2563eb;
            --gradient-light-2: #60a5fa;
            --gradient-light-3: #93c5fd;
            
            /* Dark Mode Variables (existing dark mode) */
            --bg-dark: #0f172a;
            --text-dark: #f8fafc;
            --card-bg-dark: #1e293b;
            --primary-dark: #7209b7;
        }
        
        /* Toggle Switch Styles */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.3);
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        input:checked + .slider:before {
            transform: translateX(30px);
        }
        
        body.light-mode input:checked + .slider {
            background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        }
        
        #ttsToggleStatus {
            font-weight: 600;
            color: var(--text);
        }
        
        body.light-mode #ttsToggleStatus {
            color: var(--text-light);
        }
  /* Theme Toggle Styles */
  .theme-toggle {
        background: none;
        border: none;
        color: var(--text);
        font-size: 1.5rem;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .theme-toggle:hover {
        transform: rotate(180deg);
    }

    /* Light Mode Styles */
    body.light-mode {
        background: linear-gradient(135deg, var(--bg-light), var(--accent-light) 300%);
        color: var(--text-light);
    }

    body.light-mode .subject-card,
    body.light-mode .achievements-section,
    body.light-mode .activity-feed {
        background-color: var(--card-bg-light);
        color: var(--text-light);
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
        border: 1px solid rgba(191, 219, 254, 0.3);
    }

    body.light-mode .header-content {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    body.light-mode header {
        background-color: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(37, 99, 235, 0.15);
    }

    body.light-mode .stats-overview,
    body.light-mode .progress-bar,
    body.light-mode .modal {
        background-color: var(--card-bg-light);
        border: 1px solid rgba(191, 219, 254, 0.3);
    }

    body.light-mode .quest-status,
    body.light-mode .stat,
    body.light-mode .user-profile {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--text-light);
    }

    body.light-mode .logo i,
    body.light-mode .welcome-message::after {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    body.light-mode .welcome-message::after {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
    }

    body.light-mode .btn-primary,
    body.light-mode .modal-btn.btn-primary {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    body.light-mode .progress-fill {
        background: linear-gradient(90deg, var(--gradient-light-2), var(--gradient-light-1));
    }

    body.light-mode .avatar {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
    }

    body.light-mode .stat i {
        color: var(--gradient-light-1);
    }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Gamified Header */
        header {
            background-color: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .logo i {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 2rem;
        }

        .user-stats {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
        }

        .stat i {
            color: var(--accent);
        }

        .stat-value {
            font-weight: 600;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 5px 15px 5px 5px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-profile:hover {
            background-color: rgba(0, 0, 0, 0.4);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
        }

        .user-name {
            font-weight: 600;
        }

        .user-level {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Main Content */
        main {
            padding-top: 100px;
            min-height: 100vh;
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .welcome-message {
            font-size: 2rem;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        .welcome-message::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), transparent);
            border-radius: 2px;
        }

        .sub-message {
            opacity: 0.8;
        }

        /* Quest Board */
        .quest-board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .subject-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .subject-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .subject-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(114, 9, 183, 0.2), rgba(76, 201, 240, 0.2));
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .subject-card:hover::before {
            opacity: 1;
        }

        .card-header {
            padding: 20px;
            background-size: cover;
            background-position: center;
            height: 100px;
            display: flex;
            align-items: flex-end;
            position: relative;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, var(--card-bg), transparent);
        }

        .english-bg {
            background: linear-gradient(135deg, #4cc9f0, #3a86ff);
        }

        .filipino-bg {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .science-bg {
            background: linear-gradient(135deg, #4ade80, #2dd4bf);
        }

        .math-bg {
            background: linear-gradient(135deg, #fb923c, #f97316);

        }

        .subject-title {
            font-size: 1.5rem;
            font-weight: 700;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subject-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .english-icon {
            background: linear-gradient(135deg, #4cc9f0, #3a86ff);
        }

        .filipino-icon {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .science-icon {
            background: linear-gradient(135deg, #4ade80, #2dd4bf);
        }

        .math-icon {
            background: linear-gradient(135deg, #fb923c, #f97316);
        }

        .card-content {
            padding: 20px;
        }

        .quest-progress {
            margin-top: 15px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .english-progress {
            background: linear-gradient(90deg, #4cc9f0, #3a86ff);
        }

        .filipino-progress {
            background: linear-gradient(90deg, #f72585, #b5179e);
        }

        .science-progress {
            background: linear-gradient(90deg, #4ade80, #2dd4bf);
        }

        .math-progress {
            background: linear-gradient(90deg, #fb923c, #f97316);
        }

        .rewards-info {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .rewards {
            display: flex;
            gap: 5px;
        }

        .reward-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .reward-item i {
            color: var(--warning);
        }

        .quest-status {
            background-color: rgba(79, 70, 229, 0.2);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: var(--accent);
        }

        .quest-button {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
        }

        .quest-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(114, 9, 183, 0.4);
        }

        /* Achievements Section */
        .achievements-section {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--warning);
        }

        .view-all {
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-all:hover {
            opacity: 0.8;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 15px;
        }

        .achievement {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 15px 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .achievement:hover {
            transform: translateY(-5px);
            background-color: rgba(0, 0, 0, 0.3);
        }

        .achievement-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-size: 1.2rem;
            color: white;
        }

        .achievement-name {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .achievement-progress {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        /* Activity Feed */
        .activity-feed {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }

        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .english-activity {
            background: linear-gradient(135deg, #4cc9f0, #3a86ff);
        }

        .filipino-activity {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .science-activity {
            background: linear-gradient(135deg, #4ade80, #2dd4bf);
        }

        .math-activity {
            background: linear-gradient(135deg, #fb923c, #f97316);
        }

        .activity-content {
            flex-grow: 1;
        }

        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .activity-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .activity-rewards {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .xp-reward, .coin-reward {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .xp-reward i {
            color: var(--accent);
        }

        .coin-reward i {
            color: var(--warning);
        }

        /* Welcome Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
    background-color: var(--card-bg);
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh; /* Limit height */
    overflow-y: auto; /* Enable scrolling */
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    transform: translateY(20px);
    transition: all 0.3s ease;
    position: relative;
}
.modal-content {
    padding: 25px;
    max-height: 60vh; /* Limit content height */
    overflow-y: auto; /* Enable scrolling */
}
@media (max-width: 600px) {
    .modal {
        width: 95%;
        margin: 20px auto;
    }

    .modal-content {
        padding: 15px;
    }

    .avatar-selection {
        justify-content: center;
        gap: 10px;
    }

    .avatar-option {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }
}
        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            position: relative;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .modal-subtitle {
            opacity: 0.9;
        }

        .modal-content {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(0, 0, 0, 0.2);
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(114, 9, 183, 0.2);
        }

        .avatar-selection {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .avatar-option:hover, .avatar-option.selected {
            transform: scale(1.1);
            border-color: var(--accent);
        }

        .avatar-1 {
            background: linear-gradient(135deg, #4cc9f0, #3a86ff);
        }

        .avatar-2 {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }

        .avatar-3 {
            background: linear-gradient(135deg, #4ade80, #2dd4bf);
        }

        .avatar-4 {
            background: linear-gradient(135deg, #fb923c, #f97316);
        }

        .accessibility-options {
            margin-top: 25px;
            background-color: rgba(0, 0, 0, 0.15);
            padding: 15px;
            border-radius: 10px;
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-title i {
            color: var(--accent);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .checkbox-option:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .checkbox-input {
            appearance: none;
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkbox-input:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-input:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: white;
            font-size: 0.8rem;
        }

        .checkbox-label {
            font-size: 0.95rem;
        }

        .modal-footer {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-btn {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border: none;
        }

        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding-right: 35px;
            position: relative;
        }

        .btn-primary::after {
            content: '\f054';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            transition: transform 0.3s ease;
        }

        .btn-primary:hover {
            box-shadow: 0 5px 15px rgba(114, 9, 183, 0.4);
        }

        .btn-primary:hover::after {
            transform: translate(5px, -50%);
        }

        /* Accessibility Styles */
        body.dyslexia-friendly {
            font-family: 'OpenDyslexic', 'Comic Sans MS', cursive;
            letter-spacing: 0.05em;
            word-spacing: 0.1em;
            line-height: 1.8;
        }

        body.high-contrast {
            --bg: #000;
            --card-bg: #111;
            --text: #fff;
        }

        body.color-blind-friendly .english-icon,
        body.color-blind-friendly .english-progress,
        body.color-blind-friendly .english-activity {
            background: linear-gradient(135deg, #ffbe0b, #fb5607);
        }

        body.color-blind-friendly .filipino-icon,
        body.color-blind-friendly .filipino-progress,
        body.color-blind-friendly .filipino-activity {
            background: linear-gradient(135deg, #ff006e, #8338ec);
        }

        body.color-blind-friendly .science-icon,
        body.color-blind-friendly .science-progress,
        body.color-blind-friendly .science-activity {
            background: linear-gradient(135deg, #3a86ff, #0096c7);
        }

        body.color-blind-friendly .math-icon,
        body.color-blind-friendly .math-progress,
        body.color-blind-friendly .math-activity {
            background: linear-gradient(135deg, #06d6a0, #1b9aaa);
        }

        /* Focus Mode for ADHD */
        body.focus-mode .subject-card:not(:hover),
        body.focus-mode .achievement:not(:hover),
        body.focus-mode .activity-item:not(:hover) {
            opacity: 0.6;
            filter: grayscale(50%);
        }

        body.focus-mode .subject-card:hover,
        body.focus-mode .achievement:hover,
        body.focus-mode .activity-item:hover {
            opacity: 1;
            filter: grayscale(0%);
            transform: scale(1.02);
            box-shadow: 0 0 0 3px var(--accent);
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .float {
            animation: float 4s ease-in-out infinite;
        }

        /* Responsiveness */
        @media (max-width: 768px) {
            .user-stats {
                display: none;
            }

            .welcome-message {
                font-size: 1.5rem;
            }

            .achievement-grid {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            }
        }

        /* Loader for Slow Connection */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.1);
            z-index: 101;
            display: none;
        }

        .loader {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        body.slow-connection .loader-overlay {
            display: block;
        }

        /* Chatbot Styles */
        #chatbotContainer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001; /* Above header */
        }

        #chatbotToggle {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #chatbotToggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(114, 9, 183, 0.5);
        }

        #chatbotWindow {
            position: absolute;
            bottom: 80px; /* Above the toggle button */
            right: 0;
            width: 350px;
            max-height: 450px;
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
            transform-origin: bottom right;
        }

        #chatbotWindow.hidden {
            transform: scale(0);
            opacity: 0;
            visibility: hidden;
        }

        .chatbot-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        #chatbotClose {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        #chatbotClose:hover {
            opacity: 1;
        }

        .chatbot-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .bot-message {
            background-color: rgba(76, 201, 240, 0.2); /* Accent color lightened */
            color: var(--accent);
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .user-message {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--text);
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .chatbot-suggestions {
            padding: 10px 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            max-height: 100px; /* Limit suggestion height */
            overflow-y: auto;
        }

        .suggestion-btn {
            background-color: rgba(76, 201, 240, 0.3); /* Accent */
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .suggestion-btn:hover {
            background-color: var(--accent);
            color: var(--card-bg);
        }
        /* Accessibility Dropdown Styles */
.accessibility-dropdown {
    position: relative;
    margin-left: 15px;
}

.accessibility-toggle {
    background: none;
    border: none;
    color: var(--text);
    font-size: 1.5rem;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.accessibility-toggle:hover {
    transform: rotate(15deg);
}

/* Replacing dropdown with modal */
.accessibility-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    padding: 20px;
    overflow-y: auto;
}

.accessibility-modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

.accessibility-modal {
    background-color: var(--card-bg);
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    transform: translateY(20px);
    transition: all 0.3s ease;
    position: relative;
}

.accessibility-modal-overlay.active .accessibility-modal {
    transform: translateY(0);
}

.accessibility-modal-header {
    padding: 20px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    position: relative;
}

.accessibility-modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.accessibility-modal-title i {
    font-size: 1.2rem;
}

.accessibility-modal-subtitle {
    opacity: 0.9;
}

.accessibility-modal-content {
    padding: 25px;
}

.accessibility-modal-footer {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

body.light-mode .accessibility-modal {
    background-color: var(--card-bg-light);
    box-shadow: 0 15px 30px rgba(37, 99, 235, 0.2);
}

body.light-mode .accessibility-modal-header {
    background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
}

body.light-mode .accessibility-option small {
    color: var(--text-light);
}

/* Accessibility Feature Styles */
body.dyslexia-friendly {
    font-family: 'OpenDyslexic', 'Arial', sans-serif;
    line-height: 1.5;
    letter-spacing: 0.05em;
}

body.high-contrast {
    filter: contrast(1.5);
    background-color: #000;
    color: #fff;
}

body.focus-mode .subject-card:not(:hover) {
    opacity: 0.6;
    filter: grayscale(50%);
}

body.color-blind-friendly {
    /* Add color-blind friendly color modifications */
    filter: saturate(0.7) hue-rotate(45deg);
}
.language-selector {
    margin-left: 15px;
}

.language-selector select {
    background-color: var(--card-bg);
    color: var(--text);
    border: 1px solid var(--accent);
    padding: 5px 10px;
    border-radius: 5px;
}

    body.light-mode .stat i {
        color: var(--gradient-light-1);
    }

    /* Chatbot light mode styling */
    body.light-mode #chatbotToggle {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
    }

    body.light-mode #chatbotWindow {
        background-color: var(--card-bg-light);
        box-shadow: 0 4px 20px rgba(37, 99, 235, 0.15);
        border: 1px solid rgba(191, 219, 254, 0.3);
        color: var(--text-light);
    }

    body.light-mode .chatbot-header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    body.light-mode .bot-message {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--text-light);
    }

    body.light-mode .user-message {
        background-color: rgba(37, 99, 235, 0.2);
        color: var(--text-light);
    }

    body.light-mode .chatbot-suggestions button {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1);
        border: 1px solid rgba(191, 219, 254, 0.5);
    }

    body.light-mode .chatbot-suggestions button:hover {
        background-color: rgba(37, 99, 235, 0.2);
    }

    body.light-mode .chatbot-suggestions button:hover {
        background-color: rgba(37, 99, 235, 0.2);
    }

    /* Additional light mode styling for inputs and UI elements */
    body.light-mode input, 
    body.light-mode select, 
    body.light-mode textarea {
        background-color: #ffffff;
        border: 1px solid rgba(191, 219, 254, 0.5);
        color: var(--text-light);
    }

    body.light-mode input:focus, 
    body.light-mode select:focus, 
    body.light-mode textarea:focus {
        border-color: var(--gradient-light-1);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }

    body.light-mode button,
    body.light-mode .btn {
        border: 1px solid rgba(191, 219, 254, 0.3);
    }

    body.light-mode .btn-secondary {
        background-color: #f1f5f9;
        color: var(--text-light);
    }

    body.light-mode .btn-secondary:hover {
        background-color: #e2e8f0;
    }

    body.light-mode .sidebar-nav a {
        color: var(--text-light);
    }

    body.light-mode .sidebar-nav a:hover,
    body.light-mode .sidebar-nav a.active {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1);
    }

    body.light-mode #gradeSelector {
        background-color: rgba(37, 99, 235, 0.1);
        border: 1px solid rgba(191, 219, 254, 0.5);
        color: var(--text-light);
    }

    body.light-mode .modal-header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    /* Override all specific gradients in light mode */
    body.light-mode .logo i {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
    }

    /* Subject cards & activity specific gradients */
    body.light-mode .english-bg,
    body.light-mode .english-icon,
    body.light-mode .activity-item.english-activity .icon,
    body.light-mode .achievement-card.english {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
    }

    body.light-mode .filipino-bg,
    body.light-mode .filipino-icon,
    body.light-mode .activity-item.filipino-activity .icon,
    body.light-mode .achievement-card.filipino {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-3)) !important;
        color: white !important;
    }

    body.light-mode .science-bg,
    body.light-mode .science-icon,
    body.light-mode .activity-item.science-activity .icon,
    body.light-mode .achievement-card.science {
        background: linear-gradient(135deg, var(--gradient-light-2), var(--gradient-light-1)) !important;
        color: white !important;
    }

    body.light-mode .math-bg,
    body.light-mode .math-icon,
    body.light-mode .activity-item.math-activity .icon,
    body.light-mode .achievement-card.math {
        background: linear-gradient(135deg, var(--gradient-light-3), var(--gradient-light-2)) !important;
        color: white !important;
    }

    /* Progress bars */
    body.light-mode .english-progress .progress-fill {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
    }

    body.light-mode .filipino-progress .progress-fill {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-3)) !important;
    }

    body.light-mode .science-progress .progress-fill {
        background: linear-gradient(90deg, var(--gradient-light-2), var(--gradient-light-1)) !important;
    }

    body.light-mode .math-progress .progress-fill {
        background: linear-gradient(90deg, var(--gradient-light-3), var(--gradient-light-2)) !important;
    }

    /* Badges */
    body.light-mode .badge {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
    }

    /* Avatars and user profile elements */
    body.light-mode .avatar,
    body.light-mode .reward-badge,
    body.light-mode .streak-badge {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
    }

    /* Buttons and interactive elements */
    body.light-mode .btn-primary,
    body.light-mode .modal-btn.btn-primary,
    body.light-mode .take-course-btn,
    body.light-mode .action-btn,
    body.light-mode .reward-btn {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
        border: none !important;
    }

    /* Welcome message underline */
    body.light-mode .welcome-message::after {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
    }

    /* Card overlay gradients */
    body.light-mode .subject-card::before,
    body.light-mode .quest-card::before {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(147, 197, 253, 0.1)) !important;
    }

    /* Ensure all gradient backgrounds have white text for proper contrast */
    body.light-mode [style*="linear-gradient"] {
        color: white !important;
    }

    /* Specific fixes for interactive elements and color consistency */
    body.light-mode .badges-container .badge,
    body.light-mode .achievement-badges .badge {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
    }

    /* Badge-specific colors for better light mode visibility */
    body.light-mode .badge-beginner {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-3)) !important;
    }
    
    body.light-mode .badge-intermediate {
        background: linear-gradient(135deg, var(--gradient-light-2), var(--gradient-light-1)) !important;
    }
    
    body.light-mode .badge-advanced {
        background: linear-gradient(135deg, var(--gradient-light-3), var(--gradient-light-2)) !important;
    }

    /* Fix headers and icons */
    body.light-mode .section-header i,
    body.light-mode .modal-title i {
        color: var(--gradient-light-1) !important;
    }

    /* Subject specific name colors when on gradients */
    body.light-mode .subject-card .subject-name {
        color: white !important;
    }

    /* Any unlock buttons or disabled buttons */
    body.light-mode [style*="#6c757d"],
    body.light-mode [style*="#495057"] {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        opacity: 0.7;
    }

    /* Dropdown menus and select elements */
    body.light-mode .dropdown-menu,
    body.light-mode select.form-select {
        background-color: white;
        border: 1px solid rgba(37, 99, 235, 0.2);
        color: var(--text-light);
    }

    body.light-mode .dropdown-item:hover,
    body.light-mode select.form-select option:hover {
        background-color: rgba(37, 99, 235, 0.1);
    }
    
    /* Additional fixes for any remaining elements */
    body.light-mode .notification-badge {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
    }

    /* Fix activity feed items */
    body.light-mode .activity-feed .activity-item {
        border-left: 3px solid var(--gradient-light-1);
    }

    /* Adjust stats cards */
    body.light-mode .stats-card {
        background-color: white;
        border: 1px solid rgba(191, 219, 254, 0.3);
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.1);
    }

    body.light-mode .stats-card .icon {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    /* Adjust modal styling for better contrast */
    body.light-mode .modal {
        background-color: white;
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.15);
    }

    /* Ensure consistent links */
    body.light-mode a:not(.btn):not(.modal-btn) {
        color: var(--gradient-light-1);
    }

    /* Fix any other buttons */
    body.light-mode button:not(.btn-secondary):not(.close-modal):not(.theme-toggle) {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    /* Consistent shadows for hover effects */
    body.light-mode .subject-card:hover,
    body.light-mode .achievement-card:hover,
    body.light-mode .badge:hover {
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2) !important;
    }

    /* Card headers and footers */
    body.light-mode .card-header,
    body.light-mode .modal-header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    /* Fix tooltips and popups */
    body.light-mode .tooltip,
    body.light-mode .popover {
        background-color: white;
        border: 1px solid rgba(191, 219, 254, 0.5);
        color: var(--text-light);
    }

    /* Fix scrollbars */
    body.light-mode ::-webkit-scrollbar-thumb {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        border-radius: 10px;
    }

    body.light-mode ::-webkit-scrollbar-track {
        background: rgba(191, 219, 254, 0.2);
    }
    
    /* Fix the continue bar button in light mode */
    body.light-mode .quest-button {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
        border: none !important;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.15);
    }
    
    body.light-mode .quest-button:hover {
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.25) !important;
        transform: translateY(-2px);
    }
    
    /* Fix navigation links */
    body.light-mode .nav-link,
    body.light-mode nav a,
    body.light-mode header .user-profile span,
    body.light-mode .user-name,
    body.light-mode .logo {
        color: white !important;
    }
    
    body.light-mode header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
    }
    
    /* Ensure all text labels have proper contrast */
    body.light-mode .quest-title,
    body.light-mode .quest-info,
    body.light-mode .subject-name,
    body.light-mode .level-info,
    body.light-mode .user-level {
        color: var(--text-light) !important; 
    }
    
    /* Make "Pilar-eLearn" logo text stand out */
    body.light-mode .logo {
        color: white !important;
        font-weight: bold;
    }
    
    /* Fix user stats text color */
    body.light-mode .user-stats .stat-value,
    body.light-mode .user-stats .stat {
        color: white !important;
    }
    
    /* Fix text on gradient backgrounds */
    body.light-mode [class*="-bg"] h3,
    body.light-mode [class*="-bg"] p {
        color: white !important;
    }
    
    /* English subject specific elements */
    body.light-mode .english-card .subject-name,
    body.light-mode .english-card .quest-title {
        color: white !important;
    }
    
    /* Fix user profile stats display */
    body.light-mode .user-profile .user-name,
    body.light-mode .user-profile .user-level {
        color: white !important;
    }
    
    /* Fix XP display in stats area */
    body.light-mode .stats-overview span,
    body.light-mode .stats-overview h3,
    body.light-mode .stats-card {
        color: var(--text-light) !important;
    }
    
    /* Fix level and achievement text */
    body.light-mode .level-badge,
    body.light-mode .scholar-badge,
    body.light-mode .level-text,
    body.light-mode .scholar-text {
        color: var(--text-light) !important;
    }
    
    /* Fix stats numbers to be more visible */
    body.light-mode .stat-number,
    body.light-mode .stat-label {
        color: var(--text-light) !important;
        font-weight: 600;
    }
    
    /* Fix English subject progress text */
    body.light-mode .english-progress .progress-info span,
    body.light-mode .english-card .progress-info span {
        color: var(--text-light) !important;
    }
    
    /* Fix remaining status texts */
    body.light-mode .quest-status {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1) !important;
        font-weight: 600;
    }
    
    /* Ensure all cards have proper styles */
    body.light-mode .subject-card {
        border: 1px solid rgba(191, 219, 254, 0.4);
    }
    
    /* Fix reward items text */
    body.light-mode .reward-item {
        color: var(--text-light) !important;
    }
    
    body.light-mode .reward-item i {
        color: var(--gradient-light-1) !important;
    }
    
    /* Fix all progress info text */
    body.light-mode .progress-info span {
        color: var(--text-light) !important;
    }
    
    /* Ensure all colored text matches the new theme */
    body.light-mode .text-primary {
        color: var(--gradient-light-1) !important;
    }
    
    body.light-mode .text-accent {
        color: var(--gradient-light-2) !important;
    }
    
    /* Text-to-speech styles */
    .option-section {
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 10px;
    }
    
    .option-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .speech-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    
    .speech-option {
        display: flex;
        align-items: center;
        gap: 8px;
        background-color: rgba(0, 0, 0, 0.2);
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .speech-option:hover, .speech-option.active {
        background-color: var(--primary);
    }
    
    .speech-option i {
        color: var(--accent);
    }
    
    .speech-status {
        display: none;
        margin-top: 10px;
        padding: 8px;
        border-radius: 8px;
        background-color: rgba(0, 0, 0, 0.2);
        font-size: 0.9rem;
    }
    
    .speech-status.active {
        display: block;
    }

    .text-to-speech-highlight {
        background-color: var(--primary);
        color: white;
        cursor: pointer;
    }

    .text-speech-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }

    .speech-control-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, 0.2);
        border: none;
        color: var(--text);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .speech-control-btn:hover {
        background-color: var(--primary);
    }

    .speech-demo-text {
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        background-color: rgba(0, 0, 0, 0.1);
        font-size: 0.9rem;
        cursor: pointer;
    }
    
    .option-description {
        font-size: 0.8rem;
        opacity: 0.7;
        margin-left: 30px;
        max-width: 200px;
    }

    /* Light mode specific styles for text-to-speech */
    body.light-mode .speech-option {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--text-light);
    }
    
    body.light-mode .speech-option:hover,
    body.light-mode .speech-option.active {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .speech-option i {
        color: var(--gradient-light-1);
    }
    
    body.light-mode .speech-status {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--text-light);
    }
    
    body.light-mode .text-to-speech-highlight {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .speech-control-btn {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1);
    }
    
    body.light-mode .speech-control-btn:hover {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .speech-demo-text {
        background-color: rgba(37, 99, 235, 0.05);
        color: var(--text-light);
        border: 1px solid rgba(37, 99, 235, 0.1);
    }
    
    body.light-mode .option-section {
        border-bottom: 1px solid rgba(37, 99, 235, 0.1);
    }
    
    body.light-mode .option-title i {
        color: var(--gradient-light-1);
    }
    
    /* Tooltip styles */
    .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8rem;
        z-index: 100;
        max-width: 200px;
        pointer-events: none;
    }
    
    body.light-mode .tooltip {
        background: rgba(37, 99, 235, 0.9);
        color: white;
    }

    /* Fix any other buttons */
    body.light-mode button:not(.btn-secondary):not(.close-modal):not(.theme-toggle) {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    /* Consistent shadows for hover effects */
    body.light-mode .subject-card:hover,
    body.light-mode .achievement-card:hover,
    body.light-mode .badge:hover {
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2) !important;
    }
    
    /* Card headers and footers */
    body.light-mode .card-header,
    body.light-mode .modal-header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }
    
    /* Fix tooltips and popups */
    body.light-mode .tooltip,
    body.light-mode .popover {
        background-color: white;
        border: 1px solid rgba(191, 219, 254, 0.5);
        color: var(--text-light);
    }

    /* Fix scrollbars */
    body.light-mode ::-webkit-scrollbar-thumb {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        border-radius: 10px;
    }

    body.light-mode ::-webkit-scrollbar-track {
        background: rgba(191, 219, 254, 0.2);
    }
    
    /* Fix the continue bar button in light mode */
    body.light-mode .quest-button {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
        color: white !important;
        border: none !important;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.15);
    }
    
    body.light-mode .quest-button:hover {
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.25) !important;
        transform: translateY(-2px);
    }
    
    /* Fix navigation links */
    body.light-mode .nav-link,
    body.light-mode nav a,
    body.light-mode header .user-profile span,
    body.light-mode .user-name,
    body.light-mode .logo {
        color: white !important;
    }
    
    body.light-mode header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2)) !important;
    }
    
    /* Ensure all text labels have proper contrast */
    body.light-mode .quest-title,
    body.light-mode .quest-info,
    body.light-mode .subject-name,
    body.light-mode .level-info,
    body.light-mode .user-level {
        color: var(--text-light) !important; 
    }
    
    /* Make "Pilar-eLearn" logo text stand out */
    body.light-mode .logo {
        color: white !important;
        font-weight: bold;
    }
    
    /* Fix user stats text color */
    body.light-mode .user-stats .stat-value,
    body.light-mode .user-stats .stat {
        color: white !important;
    }
    
    /* Fix text on gradient backgrounds */
    body.light-mode [class*="-bg"] h3,
    body.light-mode [class*="-bg"] p {
        color: white !important;
    }
    
    /* English subject specific elements */
    body.light-mode .english-card .subject-name,
    body.light-mode .english-card .quest-title {
        color: white !important;
    }
    
    /* Fix user profile stats display */
    body.light-mode .user-profile .user-name,
    body.light-mode .user-profile .user-level {
        color: white !important;
    }
    
    /* Fix XP display in stats area */
    body.light-mode .stats-overview span,
    body.light-mode .stats-overview h3,
    body.light-mode .stats-card {
        color: var(--text-light) !important;
    }
    
    /* Fix level and achievement text */
    body.light-mode .level-badge,
    body.light-mode .scholar-badge,
    body.light-mode .level-text,
    body.light-mode .scholar-text {
        color: var(--text-light) !important;
    }
    
    /* Fix stats numbers to be more visible */
    body.light-mode .stat-number,
    body.light-mode .stat-label {
        color: var(--text-light) !important;
        font-weight: 600;
    }
    
    /* Fix English subject progress text */
    body.light-mode .english-progress .progress-info span,
    body.light-mode .english-card .progress-info span {
        color: var(--text-light) !important;
    }
    
    /* Fix remaining status texts */
    body.light-mode .quest-status {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1) !important;
        font-weight: 600;
    }
    
    /* Ensure all cards have proper styles */
    body.light-mode .subject-card {
        border: 1px solid rgba(191, 219, 254, 0.4);
    }
    
    /* Fix reward items text */
    body.light-mode .reward-item {
        color: var(--text-light) !important;
    }
    
    body.light-mode .reward-item i {
        color: var(--gradient-light-1) !important;
    }
    
    /* Fix all progress info text */
    body.light-mode .progress-info span {
        color: var(--text-light) !important;
    }
    
    /* Ensure all colored text matches the new theme */
    body.light-mode .text-primary {
        color: var(--gradient-light-1) !important;
    }
    
    body.light-mode .text-accent {
        color: var(--gradient-light-2) !important;
    }
    
    /* Text-to-speech styles */
    .option-section {
        margin-bottom: 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 10px;
    }
    
    .option-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .speech-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
    }
    
    .speech-option {
        display: flex;
        align-items: center;
        gap: 8px;
        background-color: rgba(0, 0, 0, 0.2);
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .speech-option:hover, .speech-option.active {
        background-color: var(--primary);
    }
    
    .speech-option i {
        color: var(--accent);
    }
    
    .speech-status {
        display: none;
        margin-top: 10px;
        padding: 8px;
        border-radius: 8px;
        background-color: rgba(0, 0, 0, 0.2);
        font-size: 0.9rem;
    }
    
    .speech-status.active {
        display: block;
    }

    .text-to-speech-highlight {
        background-color: var(--primary);
        color: white;
        cursor: pointer;
    }

    .text-speech-controls {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }

    .speech-control-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, 0.2);
        border: none;
        color: var(--text);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .speech-control-btn:hover {
        background-color: var(--primary);
    }

    .speech-demo-text {
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        background-color: rgba(0, 0, 0, 0.1);
        font-size: 0.9rem;
        cursor: pointer;
    }
    
    .option-description {
        font-size: 0.8rem;
        opacity: 0.7;
        margin-left: 30px;
        max-width: 200px;
    }

    /* Light mode specific styles for text-to-speech */
    body.light-mode .speech-option {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--text-light);
    }
    
    body.light-mode .speech-option:hover,
    body.light-mode .speech-option.active {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .speech-option i {
        color: var(--gradient-light-1);
    }
    
    body.light-mode .speech-status {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--text-light);
    }
    
    body.light-mode .text-to-speech-highlight {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .speech-control-btn {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1);
    }
    
    body.light-mode .speech-control-btn:hover {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .speech-demo-text {
        background-color: rgba(37, 99, 235, 0.05);
        color: var(--text-light);
        border: 1px solid rgba(37, 99, 235, 0.1);
    }
    
    body.light-mode .option-section {
        border-bottom: 1px solid rgba(37, 99, 235, 0.1);
    }
    
    body.light-mode .option-title i {
        color: var(--gradient-light-1);
    }
    
    /* Tooltip styles */
    .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.8rem;
        z-index: 100;
        max-width: 200px;
        pointer-events: none;
    }
    
    body.light-mode .tooltip {
        background: rgba(37, 99, 235, 0.9);
        color: white;
    }

    /* Fix any other buttons */
    body.light-mode button:not(.btn-secondary):not(.close-modal):not(.theme-toggle) {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }

    /* Consistent shadows for hover effects */
    body.light-mode .subject-card:hover,
    body.light-mode .achievement-card:hover,
    body.light-mode .badge:hover {
        box-shadow: 0 10px 25px rgba(37, 99, 235, 0.2) !important;
    }
    
    /* Card headers and footers */
    body.light-mode .card-header,
    body.light-mode .modal-header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }
    
    /* Achievements section in light mode */
    body.light-mode .achievements-section .section-title i {
        color: var(--gradient-light-1);
    }
    
    body.light-mode .view-all {
        color: var(--gradient-light-1);
        position: relative;
        padding-right: 5px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    body.light-mode .view-all:hover {
        color: var(--gradient-light-2);
    }
    
    body.light-mode .view-all i {
        transition: transform 0.3s ease;
    }
    
    body.light-mode .view-all:hover i {
        transform: translateX(3px);
    }
    
    body.light-mode .view-all::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        transition: width 0.3s ease;
    }
    
    body.light-mode .view-all:hover::after {
        width: 100%;
    }
    
    body.light-mode .achievement {
        background-color: rgba(37, 99, 235, 0.05);
        border: 1px solid rgba(37, 99, 235, 0.1);
        transition: all 0.3s ease;
    }
    
    body.light-mode .achievement:hover {
        background-color: rgba(37, 99, 235, 0.1);
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(37, 99, 235, 0.15);
    }
    
    body.light-mode .achievement-icon {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }
    
    body.light-mode .achievement-name {
        color: var(--text-light);
        font-weight: bold;
    }
    
    body.light-mode .achievement-progress {
        color: var(--gradient-light-1);
        font-weight: 600;
    }
    
    /* Activity Feed in light mode */
    body.light-mode .activity-feed .section-title i {
        color: var(--gradient-light-1);
    }
    
    body.light-mode .activity-item {
        background-color: rgba(37, 99, 235, 0.05);
        border: 1px solid rgba(37, 99, 235, 0.1);
        transition: all 0.3s ease;
    }
    
    body.light-mode .activity-item:hover {
        background-color: rgba(37, 99, 235, 0.1);
        box-shadow: 0 6px 15px rgba(37, 99, 235, 0.15);
    }
    
    body.light-mode .activity-icon.english-activity,
    body.light-mode .activity-icon.filipino-activity,
    body.light-mode .activity-icon.science-activity,
    body.light-mode .activity-icon.math-activity {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
    }
    
    body.light-mode .activity-title {
        color: var(--text-light);
        font-weight: 600;
    }
    
    body.light-mode .activity-details {
        color: var(--text-light);
    }
    
    body.light-mode .activity-time {
        color: rgba(30, 58, 138, 0.7);
    }
    
    body.light-mode .xp-reward i,
    body.light-mode .coin-reward i {
        color: var(--gradient-light-1);
    }
    
    body.light-mode .xp-reward,
    body.light-mode .coin-reward {
        background-color: rgba(37, 99, 235, 0.08);
        border-radius: 15px;
        padding: 3px 8px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    body.light-mode .xp-reward span,
    body.light-mode .coin-reward span {
        color: var(--text-light);
    }
    
    /* Avatar selection in light mode */
    body.light-mode .avatar-selection .avatar-option {
        background: rgba(37, 99, 235, 0.1);
        border: 3px solid transparent;
        color: var(--gradient-light-1);
    }
    
    body.light-mode .avatar-selection .avatar-option:hover,
    body.light-mode .avatar-selection .avatar-option.selected {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        border-color: white;
        color: white;
        transform: scale(1.1);
    }
    
    body.light-mode .avatar-selection .avatar-option.selected {
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.3);
    }
    
    /* Section headers in light mode */
    body.light-mode .section-header {
        border-bottom: 1px solid rgba(37, 99, 235, 0.1);
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    body.light-mode .section-title {
        color: var(--gradient-light-1);
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    body.light-mode .section-title::after {
        content: '';
        position: absolute;
        bottom: -12px;
        left: 0;
        width: 60px;
        height: 3px;
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
        border-radius: 3px;
    }
    
    body.light-mode .achievements-section,
    body.light-mode .activity-feed {
        position: relative;
        overflow: hidden;
    }
    
    body.light-mode .achievements-section::before,
    body.light-mode .activity-feed::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--gradient-light-1), transparent);
        border-radius: 5px 5px 0 0;
    }
    
    /* Fix tooltips and popups */
    body.light-mode .modal-btn {
        transition: all 0.3s ease;
    }
    
    body.light-mode .modal-btn.btn-primary {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        color: white;
        border: none;
        position: relative;
        z-index: 1;
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
    }
    
    body.light-mode .modal-btn.btn-primary:hover {
        box-shadow: 0 6px 15px rgba(37, 99, 235, 0.3);
        transform: translateY(-2px);
    }
    
    body.light-mode .modal-btn.btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--gradient-light-2), var(--gradient-light-1));
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 10px;
    }
    
    body.light-mode .modal-btn.btn-primary:hover::before {
        opacity: 1;
    }
    
    body.light-mode .modal-btn.btn-secondary {
        background-color: rgba(37, 99, 235, 0.1);
        color: var(--gradient-light-1);
        border: 1px solid rgba(37, 99, 235, 0.2);
    }
    
    body.light-mode .modal-btn.btn-secondary:hover {
        background-color: rgba(37, 99, 235, 0.15);
        color: var(--gradient-light-1);
    }
    
    /* Floating Text-to-Speech Button */
    .tts-toggle-btn {
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        z-index: 999;
        border: none;
        transition: all 0.3s ease;
    }
    
    .tts-toggle-btn:hover {
        transform: scale(1.1);
    }
    
    .tts-toggle-btn i {
        font-size: 1.3rem;
    }
    
    .tts-toggle-btn.active {
        background: linear-gradient(135deg, var(--success), var(--accent));
    }
    
    /* TTS language selector */
    .tts-language-dropdown {
        position: fixed;
        bottom: 160px;
        right: 20px;
        background-color: var(--card-bg);
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        z-index: 999;
        display: none;
        flex-direction: column;
        gap: 8px;
        transition: all 0.3s ease;
        transform: translateY(20px);
        opacity: 0;
    }
    
    .tts-language-dropdown.show {
        display: flex;
        transform: translateY(0);
        opacity: 1;
    }
    
    .tts-language-option {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--text);
    }
    
    .tts-language-option:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .tts-language-option.active {
        background-color: var(--primary);
        color: white;
    }
    
    .tts-language-option i {
        color: var(--accent);
    }
    
    /* Highlight effect for text being read */
    .tts-reading {
        background-color: rgba(114, 9, 183, 0.2);
        border-radius: 3px;
        transition: background-color 0.3s ease;
        position: relative;
    }
    
    .tts-controls {
        position: fixed;
        bottom: 160px;
        right: 80px;
        display: none;
        background-color: var(--card-bg);
        border-radius: 25px;
        padding: 5px 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        z-index: 999;
        align-items: center;
        gap: 10px;
        transition: all 0.3s ease;
    }
    
    .tts-controls.show {
        display: flex;
    }
    
    .tts-control-btn {
        background: none;
        border: none;
        color: var(--text);
        padding: 5px;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .tts-control-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    /* Light mode styles for TTS elements */
    body.light-mode .tts-toggle-btn {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
    }
    
    body.light-mode .tts-toggle-btn.active {
        background: linear-gradient(135deg, var(--success), var(--gradient-light-2));
    }
    
    body.light-mode .tts-language-dropdown {
        background-color: white;
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
        border: 1px solid rgba(37, 99, 235, 0.1);
    }
    
    body.light-mode .tts-language-option {
        color: var(--text-light);
    }
    
    body.light-mode .tts-language-option:hover {
        background-color: rgba(37, 99, 235, 0.05);
    }
    
    body.light-mode .tts-language-option.active {
        background-color: var(--gradient-light-1);
        color: white;
    }
    
    body.light-mode .tts-language-option i {
        color: var(--gradient-light-1);
    }
    
    body.light-mode .tts-reading {
        background-color: rgba(37, 99, 235, 0.15);
    }
    
    body.light-mode .tts-controls {
        background-color: white;
        box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
        border: 1px solid rgba(37, 99, 235, 0.1);
    }
    
    body.light-mode .tts-control-btn {
        color: var(--text-light);
    }
    
    body.light-mode .tts-control-btn:hover {
        background-color: rgba(37, 99, 235, 0.1);
    }

    /* User profile accessibility button */
    .accessibility-btn {
        background: none;
        border: none;
        color: var(--text);
        font-size: 1rem;
        cursor: pointer;
        padding: 0 5px;
        transition: transform 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-left: 5px;
    }

    .accessibility-btn:hover {
        transform: rotate(15deg);
        color: var(--accent);
    }

    body.light-mode .accessibility-btn {
        color: white;
    }

    body.light-mode .accessibility-btn:hover {
        color: var(--gradient-light-3);
    }

    /* Enhanced Chatbot Styling */
    .chatbot-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1001;
    }

    .chatbot-window {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        height: 450px;
        background-color: var(--card-bg);
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: all 0.3s ease;
        transform-origin: bottom right;
    }

    .chatbot-window.hidden {
        transform: scale(0);
        opacity: 0;
        visibility: hidden;
    }

    .chatbot-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        border-radius: 15px 15px 0 0;
    }

    .chatbot-title {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chatbot-title::before {
        content: '';
        display: inline-block;
        width: 10px;
        height: 10px;
        background-color: #4ade80;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    .chatbot-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.3s ease;
    }

    .chatbot-close:hover {
        opacity: 1;
    }

    .chatbot-messages {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary) rgba(0, 0, 0, 0.1);
    }

    .chatbot-messages::-webkit-scrollbar {
        width: 6px;
    }

    .chatbot-messages::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
    }

    .chatbot-messages::-webkit-scrollbar-thumb {
        background-color: var(--primary);
        border-radius: 3px;
    }

    .message {
        padding: 12px 16px;
        border-radius: 18px;
        max-width: 85%;
        word-wrap: break-word;
        line-height: 1.4;
        position: relative;
        animation: messageAppear 0.3s ease forwards;
    }

    @keyframes messageAppear {
        from { 
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .bot-message {
        background: linear-gradient(135deg, rgba(76, 201, 240, 0.15), rgba(58, 134, 255, 0.15));
        color: var(--text);
        align-self: flex-start;
        border-bottom-left-radius: 5px;
        border-left: 3px solid var(--accent);
    }

    .user-message {
        background: linear-gradient(135deg, rgba(114, 9, 183, 0.15), rgba(114, 9, 183, 0.25));
        color: var(--text);
        align-self: flex-end;
        border-bottom-right-radius: 5px;
        border-right: 3px solid var(--primary);
    }

    .chatbot-input-container {
        display: flex;
        padding: 12px 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        background-color: rgba(0, 0, 0, 0.05);
    }

    .chatbot-input {
        flex-grow: 1;
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 10px 15px;
        color: var(--text);
        outline: none;
        transition: all 0.3s ease;
    }

    .chatbot-input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(114, 9, 183, 0.2);
    }

    .chatbot-send {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        margin-left: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .chatbot-send:hover {
        transform: scale(1.1);
    }

    .chatbot-suggestions {
        padding: 10px 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        max-height: 100px;
        overflow-y: auto;
        background-color: rgba(0, 0, 0, 0.02);
    }

    .suggestion-btn {
        background-color: rgba(76, 201, 240, 0.15);
        border: 1px solid rgba(76, 201, 240, 0.3);
        color: var(--accent);
        padding: 8px 14px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        white-space: nowrap;
    }

    .suggestion-btn:hover {
        background-color: rgba(76, 201, 240, 0.3);
        transform: translateY(-2px);
    }

    .chatbot-toggle {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        font-size: 1.8rem;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .chatbot-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 20px rgba(114, 9, 183, 0.5);
    }

    .chatbot-toggle::after {
        content: '';
        position: absolute;
        width: 12px;
        height: 12px;
        background-color: #4ade80;
        border-radius: 50%;
        top: 10px;
        right: 10px;
        border: 2px solid var(--card-bg);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7);
        }
        70% {
            box-shadow: 0 0 0 10px rgba(74, 222, 128, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(74, 222, 128, 0);
        }
    }

    /* Light mode styles for chatbot */
    body.light-mode .chatbot-window {
        background-color: var(--card-bg-light);
        box-shadow: 0 4px 20px rgba(37, 99, 235, 0.15);
    }

    body.light-mode .chatbot-header {
        background: linear-gradient(90deg, var(--gradient-light-1), var(--gradient-light-2));
    }

    body.light-mode .chatbot-toggle {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
    }

    body.light-mode .chatbot-toggle::after {
        border-color: var(--card-bg-light);
    }

    body.light-mode .bot-message {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(59, 130, 246, 0.12));
        border-left: 3px solid var(--gradient-light-1);
    }

    body.light-mode .user-message {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(59, 130, 246, 0.2));
        border-right: 3px solid var(--gradient-light-1);
    }

    body.light-mode .suggestion-btn {
        background-color: rgba(37, 99, 235, 0.08);
        border: 1px solid rgba(37, 99, 235, 0.2);
        color: var(--gradient-light-1);
    }

    body.light-mode .suggestion-btn:hover {
        background-color: rgba(37, 99, 235, 0.15);
    }

    body.light-mode .chatbot-input {
        background-color: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(37, 99, 235, 0.2);
        color: var(--text-light);
    }

    body.light-mode .chatbot-input:focus {
        border-color: var(--gradient-light-1);
        box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.15);
    }

    body.light-mode .chatbot-send {
        background: linear-gradient(135deg, var(--gradient-light-1), var(--gradient-light-2));
    }

    /* Hide floating TTS button */
    .tts-toggle-btn, .tts-controls, .tts-language-dropdown {
        display: none !important;
    }
    </style>
    <div class="loader-overlay">
    </style>
        <div class="loader"></div>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="theme-controls">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle Dark/Light Mode">
                    <i class="fas fa-adjust"></i>
                </button>
                <button class="accessibility-toggle" id="accessibilityToggle" aria-label="Accessibility Options">
                    <i class="fas fa-universal-access"></i>
                </button>
            </div>
            <div class="logo">
                <i class="fas fa-gamepad"></i>
                Pilar-eLearn
            </div>
            <div class="user-stats">
                <div class="stat">
                    <i class="fas fa-bolt"></i>
                    <span class="stat-value">1,250 XP</span>
                </div>
                <div class="stat">
                    <i class="fas fa-coins"></i>
                    <span class="stat-value">175</span>
                </div>
                <div class="stat">
                    <i class="fas fa-trophy"></i>
                    <span class="stat-value">12/50</span>
                </div>
            </div>
            <div class="user-profile" id="userProfileDisplay">
                <div class="avatar" id="userAvatarDisplay">JS</div>
                <div>
                    <div class="user-name" id="userNameDisplay">Player</div>
                    <div class="user-level">
                        Level 5 Scholar

                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="dashboard-header">
                <h1 class="welcome-message">Welcome to your adventure, <span id="welcomeNameDisplay">Scholar</span>!</h1>
                <p class="sub-message">Continue your quests and earn rewards. You're making great progress!</p>
            </div>

            <!-- Quest Board (Subject Cards) -->
            <div class="quest-board">
                <!-- English -->
                <div class="subject-card">
                    <div class="card-header english-bg">
                        <div class="subject-title">
                            <div class="subject-icon english-icon">
                                <i class="fas fa-book"></i>
                            </div>
                            English
                        </div>
                    </div>
                    <div class="card-content">
                        <h3>Current Quest</h3>
                        <p>Literary Analysis: The Hero's Journey</p>

                        <div class="quest-progress">
                            <div class="progress-info">
                                <span>Quest Progress</span>
                                <span>75%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill english-progress" style="width: 75%"></div>
                            </div>
                        </div>

                        <div class="rewards-info">
                            <div class="rewards">
                                <div class="reward-item">
                                    <i class="fas fa-bolt"></i>
                                    <span>100 XP</span>
                                </div>
                                <div class="reward-item">
                                    <i class="fas fa-coins"></i>
                                    <span>25</span>
                                </div>
                            </div>
                            <div class="quest-status">In Progress</div>
                        </div>

                        <button class="quest-button" data-subject="english" data-title="Literary Analysis: The Hero's Journey" data-description="Learn how to analyze the hero's journey across different literary works.">Continue Quest</button>
                    </div>
                </div>

                <!-- Filipino -->
                <div class="subject-card">
                    <div class="card-header filipino-bg">
                        <div class="subject-title">
                            <div class="subject-icon filipino-icon">
                                <i class="fas fa-pen"></i>
                            </div>
                            Filipino
                        </div>
                    </div>
                    <div class="card-content">
                        <h3>Current Quest</h3>
                        <p>Panitikang Pilipino: Noli Me Tangere</p>

                        <div class="quest-progress">
                            <div class="progress-info">
                                <span>Quest Progress</span>
                                <span>60%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill filipino-progress" style="width: 60%"></div>
                            </div>
                        </div>

                        <div class="rewards-info">
                            <div class="rewards">
                                <div class="reward-item">
                                    <i class="fas fa-bolt"></i>
                                    <span>85 XP</span>
                                </div>
                                <div class="reward-item">
                                    <i class="fas fa-coins"></i>
                                    <span>20</span>
                                </div>
                            </div>
                            <div class="quest-status">In Progress</div>
                        </div>

                        <button class="quest-button" data-subject="filipino" data-title="Panitikang Pilipino: Noli Me Tangere" data-description="Pag-aaral ng pambansang nobela ni Jose Rizal at ang kahulugan nito sa ating kasaysayan at lipunan.">Continue Quest</button>
                    </div>
                </div>

                <!-- Science -->
                <div class="subject-card">
                    <div class="card-header science-bg">
                        <div class="subject-title">
                            <div class="subject-icon science-icon">
                                <i class="fas fa-flask"></i>
                            </div>
                            Science
                        </div>
                    </div>
                    <div class="card-content">
                        <h3>Current Quest</h3>
                        <p>Earth Science: Plate Tectonics</p>

                        <div class="quest-progress">
                            <div class="progress-info">
                                <span>Quest Progress</span>
                                <span>82%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill science-progress" style="width: 82%"></div>
                            </div>
                        </div>

                        <div class="rewards-info">
                            <div class="rewards">
                                <div class="reward-item">
                                    <i class="fas fa-bolt"></i>
                                    <span>120 XP</span>
                                </div>
                                <div class="reward-item">
                                    <i class="fas fa-coins"></i>
                                    <span>30</span>
                                </div>
                            </div>
                            <div class="quest-status">Almost Done!</div>
                        </div>

                        <button class="quest-button" data-subject="science" data-title="Earth Science: Plate Tectonics" data-description="Learn about how the Earth's crust is divided into tectonic plates and how their movements shape our planet's geography and create natural phenomena.">Continue Quest</button>
                    </div>
                </div>

                <!-- Math -->
                <div class="subject-card">
                    <div class="card-header math-bg">
                        <div class="subject-title">
                            <div class="subject-icon math-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            Math
                        </div>
                    </div>
                    <div class="card-content">
                        <h3>Current Quest</h3>
                        <p>Algebra: Quadratic Equations</p>

                        <div class="quest-progress">
                            <div class="progress-info">
                                <span>Quest Progress</span>
                                <span>45%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill math-progress" style="width: 45%"></div>
                            </div>
                        </div>

                        <div class="rewards-info">
                            <div class="rewards">
                                <div class="reward-item">
                                    <i class="fas fa-bolt"></i>
                                    <span>150 XP</span>
                                </div>
                                <div class="reward-item">
                                    <i class="fas fa-coins"></i>
                                    <span>40</span>
                                </div>
                            </div>
                            <div class="quest-status">In Progress</div>
                        </div>

                        <button class="quest-button" data-subject="math" data-title="Algebra: Quadratic Equations" data-description="Master solving quadratic equations using different methods including factoring, completing the square, and the quadratic formula.">Continue Quest</button>
                    </div>
                </div>
            </div>

            <!-- Achievements Section -->
            <section class="achievements-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-trophy"></i>
                        Achievements
                    </h2>
                    <div class="view-all">
                        View All
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="achievements-grid">
                    <div class="achievement">
                        <div class="achievement-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="achievement-name">Bookworm</div>
                        <div class="achievement-progress">3/5</div>
                    </div>
                    <div class="achievement">
                        <div class="achievement-icon">
                            <i class="fas fa-pen"></i>
                        </div>
                        <div class="achievement-name">Writer</div>
                        <div class="achievement-progress">2/3</div>
                    </div>
                    <div class="achievement">
                        <div class="achievement-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="achievement-name">Scientist</div>
                        <div class="achievement-progress">4/5</div>
                    </div>
                    <div class="achievement">
                        <div class="achievement-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="achievement-name">Mathematician</div>
                        <div class="achievement-progress">1/4</div>
                    </div>
                    <div class="achievement">
                        <div class="achievement-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="achievement-name">Streak Master</div>
                        <div class="achievement-progress">7/10</div>
                    </div>
                    <div class="achievement">
                        <div class="achievement-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="achievement-name">Perfect Score</div>
                        <div class="achievement-progress">2/5</div>
                    </div>
                </div>
            </section>

            <!-- Activity Feed -->
            <section class="activity-feed">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Recent Activity
                    </h2>
                    <div class="view-all">
                        View All
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon english-activity">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Completed English Quiz: Elements of a Story</div>
                            <div class="activity-details">
                                <div class="activity-time">2 hours ago</div>
                                <div class="activity-rewards">
                                    <div class="xp-reward">
                                        <i class="fas fa-bolt"></i>
                                        <span>50 XP</span>
                                    </div>
                                    <div class="coin-reward">
                                        <i class="fas fa-coins"></i>
                                        <span>15</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon science-activity">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Watched Science Video: Types of Plate Boundaries</div>
                            <div class="activity-details">
                                <div class="activity-time">Yesterday</div>
                                <div class="activity-rewards">
                                    <div class="xp-reward">
                                        <i class="fas fa-bolt"></i>
                                        <span>30 XP</span>
                                    </div>
                                    <div class="coin-reward">
                                        <i class="fas fa-coins"></i>
                                        <span>5</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon filipino-activity">
                            <i class="fas fa-pen"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">Submitted Filipino Essay: Kahalagahan ng Wikang Filipino</div>
                            <div class="activity-details">
                                <div class="activity-time">2 days ago</div>
                                <div class="activity-rewards">
                                    <div class="xp-reward">
                                        <i class="fas fa-bolt"></i>
                                        <span>75 XP</span>
                                    </div>
                                    <div class="coin-reward">
                                        <i class="fas fa-coins"></i>
                                        <span>20</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Welcome Modal -->
    <div class="modal-overlay active" id="welcomeModal">
        <div class="modal">
            <div class="modal-header">
                <div id="modalTitle" class="modal-title">Welcome to Pilar-eLearn!</div>
                <div id="modalSubtitle" class="modal-subtitle">Create your learning adventure profile</div>
            </div>
            <div class="modal-content">
                <form id="userProfileForm">
                    <div class="form-group">
                        <label class="form-label" for="userName">Your Name</label>
                        <input type="text" class="form-control" id="userName" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="userEmail">Your Email</label>
                        <input type="email" class="form-control" id="userEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="gradeLevel">Grade Level</label>
                        <select class="form-control" id="gradeLevel" style="background-color: var(--card-bg); color: var(--text); border: 1px solid var(--accent);">
                            <option value="" style="color: var(--text);">Select your grade</option>
                            <option value="1" style="color: var(--text);">Grade 1</option>
                            <option value="2" style="color: var(--text);">Grade 2</option>
                            <option value="3" style="color: var(--text);">Grade 3</option>
                            <option value="4" style="color: var(--text);">Grade 4</option>
                            <option value="5" style="color: var(--text);">Grade 5</option>
                            <option value="6" style="color: var(--text);">Grade 6</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Choose Your Avatar</label>
                        <div class="avatar-selection">
                            <div class="avatar-option avatar-1 selected" data-avatar="1">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="avatar-option avatar-2" data-avatar="2">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="avatar-option avatar-3" data-avatar="3">
                                <i class="fas fa-user-astronaut"></i>
                            </div>
                            <div class="avatar-option avatar-4" data-avatar="4">
                                <i class="fas fa-user-ninja"></i>
                            </div>
                        </div>
                    </div>
                    <div class="accessibility-options">
                        <div class="option-title">
                            <i class="fas fa-universal-access"></i>
                            Accessibility Options
                        </div>
                        <p>These options help make learning more accessible for all students:</p>
                        
                        <div class="option-section">
                            <div class="option-title">
                                <i class="fas fa-volume-up"></i>
                                Text-to-Speech
                            </div>
                            <p>Enable text reading in your preferred language. Click on text to hear it read aloud:</p>
                            <div class="tts-toggle-wrapper" style="margin-bottom: 10px; display: flex; align-items: center;">
                                <label class="switch" style="position: relative; display: inline-block; width: 60px; height: 30px; margin-right: 10px;">
                                    <input type="checkbox" id="ttsEnabledToggle" checked>
                                    <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.2); transition: .4s; border-radius: 34px;"></span>
                                </label>
                                <span id="ttsToggleStatus">Text-to-Speech Enabled</span>
                            </div>
                            <div class="speech-options">
                                <div class="speech-option" data-lang="en-US">
                                    <i class="fas fa-volume-up"></i>
                                    <span>English</span>
                                </div>
                                <div class="speech-option" data-lang="fil-PH">
                                    <i class="fas fa-volume-up"></i>
                                    <span>Tagalog</span>
                                </div>
                                <div class="speech-option" data-lang="fil-en">
                                    <i class="fas fa-volume-up"></i>
                                    <span>Taglish</span>
                                </div>
                            </div>
                            <div class="text-speech-controls">
                                <button class="speech-control-btn" id="pauseResumeBtn" title="Pause/Resume Speech">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="speech-control-btn" id="stopSpeechBtn" title="Stop Speech">
                                    <i class="fas fa-stop"></i>
                                </button>
                                <span id="speechVolumeControl">
                                    <i class="fas fa-volume-up"></i>
                                    <input type="range" min="0" max="1" step="0.1" value="1" id="volumeSlider">
                                </span>
                            </div>
                            <div class="speech-status" id="speechStatus">
                                Select a language and click on any text to hear it
                            </div>
                            <div class="speech-demo-text" id="demoText">
                                Click here to test the text-to-speech in your selected language. This example will be read aloud.
                            </div>
                        </div>
                        
                        <div class="option-section">
                            <div class="option-title">
                                <i class="fas fa-user-cog"></i>
                                Display & Interface Options
                            </div>
                            <div class="checkbox-group">
                                <label class="checkbox-option" title="Uses a dyslexia-friendly font and improved spacing to make text easier to read">
                                    <input type="checkbox" class="checkbox-input" id="dyslexiaOption">
                                    <span class="checkbox-label">Dyslexia Support</span>
                                    <div class="option-description">Uses special fonts and spacing to make text easier to read</div>
                                </label>
                                <label class="checkbox-option" title="Highlights content you're focusing on and reduces distractions">
                                    <input type="checkbox" class="checkbox-input" id="adhOption">
                                    <span class="checkbox-label">ADHD Focus Mode</span>
                                    <div class="option-description">Reduces distractions and highlights what you're focusing on</div>
                                </label>
                                <label class="checkbox-option" title="Changes color schemes to be distinguishable for different types of color blindness">
                                    <input type="checkbox" class="checkbox-input" id="colorBlindOption">
                                    <span class="checkbox-label">Color Blind Friendly</span>
                                    <div class="option-description">Adjusts colors to be more distinguishable</div>
                                </label>
                                <label class="checkbox-option" title="Increases contrast between text and background">
                                    <input type="checkbox" class="checkbox-input" id="highContrastOption">
                                    <span class="checkbox-label">High Contrast</span>
                                    <div class="option-description">Makes text and backgrounds more distinct</div>
                                </label>
                                <label class="checkbox-option" title="Reduces animations and optimizes content for slower internet connections">
                                    <input type="checkbox" class="checkbox-input" id="slowConnectionOption">
                                    <span class="checkbox-label">Low Bandwidth Mode</span>
                                    <div class="option-description">Optimizes for slower internet connections</div>
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" id="skipButton">Skip for Now</button>
                <button class="modal-btn btn-primary" id="startButton">Start Adventure</button>
            </div>
        </div>
    </div>
    <script src="languages.js"></script>

    <script>
 

  
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const welcomeModal = document.getElementById('welcomeModal');
            const userProfileForm = document.getElementById('userProfileForm');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const gradeLevel = document.getElementById('gradeLevel');
            const avatarOptions = document.querySelectorAll('.avatar-option');
            const skipButton = document.getElementById('skipButton');
            const startButton = document.getElementById('startButton');
            
            // Accessibility checkboxes
            const dyslexiaOption = document.getElementById('dyslexiaOption');
            const adhOption = document.getElementById('adhOption');
            const colorBlindOption = document.getElementById('colorBlindOption');
            const highContrastOption = document.getElementById('highContrastOption');
            const slowConnectionOption = document.getElementById('slowConnectionOption');
            
            // User display elements
            const userNameDisplay = document.getElementById('userNameDisplay');
            const welcomeNameDisplay = document.getElementById('welcomeNameDisplay');
            const userAvatarDisplay = document.getElementById('userAvatarDisplay');
            const userProfileDisplay = document.getElementById('userProfileDisplay');
            
            initTextToSpeech();
            initThemeToggle();
            
            // Speech recognition functionality
            const speechOptions = document.querySelectorAll('.speech-option');
            const speechStatus = document.getElementById('speechStatus');
            const demoText = document.getElementById('demoText');
            const pauseResumeBtn = document.getElementById('pauseResumeBtn');
            const stopSpeechBtn = document.getElementById('stopSpeechBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const ttsEnabledToggle = document.getElementById('ttsEnabledToggle');
            const ttsToggleStatus = document.getElementById('ttsToggleStatus');
            let activeSpeechOption = null;
            let currentUtterance = null;
            
            // Initialize TTS toggle state
            const ttsEnabled = localStorage.getItem('textToSpeechEnabled');
            if (ttsEnabled !== null) {
                ttsEnabledToggle.checked = ttsEnabled === 'true';
                ttsToggleStatus.textContent = ttsEnabled === 'true' ? 'Text-to-Speech Enabled' : 'Text-to-Speech Disabled';
            } else {
                localStorage.setItem('textToSpeechEnabled', 'true');
            }
            
            // TTS toggle event listener
            ttsEnabledToggle.addEventListener('change', function() {
                const isEnabled = this.checked;
                ttsToggleStatus.textContent = isEnabled ? 'Text-to-Speech Enabled' : 'Text-to-Speech Disabled';
                localStorage.setItem('textToSpeechEnabled', isEnabled ? 'true' : 'false');
                
                // Update floating TTS button state if it exists
                const ttsToggleBtn = document.getElementById('ttsToggleBtn');
                if (ttsToggleBtn) {
                    ttsToggleBtn.classList.toggle('active', isEnabled);
                }
            });

            // Check if browser supports speech synthesis
            if ('speechSynthesis' in window) {
                // Text to speech functionality
                const synth = window.speechSynthesis;
                let voices = [];

                // Get available voices
                function loadVoices() {
                    voices = synth.getVoices();
                    speechStatus.textContent = "Text-to-speech ready. Select a language and click on text.";
                }

                // Chrome needs this to be called explicitly
                if (synth.onvoiceschanged !== undefined) {
                    synth.onvoiceschanged = loadVoices;
                }
                
                // Initial load of voices
                loadVoices();
                
                // Helper function to find the best voice for a language
                function findVoice(lang) {
                    // Look for exact match first
                    let exactMatch = voices.find(voice => voice.lang === lang);
                    if (exactMatch) return exactMatch;
                    
                    // Look for partial match (e.g., 'en-US' would match with 'en')
                    let partialMatch = voices.find(voice => voice.lang.substring(0, 2) === lang.substring(0, 2));
                    if (partialMatch) return partialMatch;
                    
                    // Default to first available voice
                    return voices[0];
                }
                
                // Function to speak text
                function speakText(text, lang) {
                    // Only speak if TTS is enabled
                    if (localStorage.getItem('textToSpeechEnabled') !== 'true') {
                        return null;
                    }

                    // Cancel any ongoing speech
                    if (synth.speaking) {
                        synth.cancel();
                    }
                    
                    // Create utterance
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Set language based on selection
                    if (lang === "fil-en") {
                        // For Taglish, we use English voice but with some modifications
                        utterance.voice = findVoice("en-US");
                        utterance.rate = 0.9; // Slightly slower for Taglish
                    } else if (lang === "fil-PH") {
                        utterance.voice = findVoice("fil-PH");
                        // If Filipino voice not available, use English but slower
                        if (utterance.voice.lang.substring(0, 2) !== "fi") {
                            utterance.rate = 0.8;
                        }
                    } else {
                        utterance.voice = findVoice(lang);
                    }
                    
                    // Set volume from slider
                    utterance.volume = volumeSlider.value;
                    
                    // Save reference to current utterance
                    currentUtterance = utterance;
                    
                    // Update status
                    speechStatus.textContent = "Speaking...";
                    speechStatus.classList.add('active');
                    
                    // Speech end event
                    utterance.onend = function() {
                        speechStatus.textContent = "Text-to-speech ready";
                        currentUtterance = null;
                        pauseResumeBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    };
                    
                    // Speak
                    synth.speak(utterance);
                    
                    return utterance;
                }
                
                // Add click event to speech options
                speechOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        const lang = this.getAttribute('data-lang');
                        
                        // Reset active option
                        if (activeSpeechOption) {
                            activeSpeechOption.classList.remove('active');
                        }
                        
                        // Set new active option
                        this.classList.add('active');
                        activeSpeechOption = this;
                        
                        // Store preference
                        localStorage.setItem('textToSpeechLanguage', lang);
                        
                        // Update status
                        speechStatus.textContent = `Text-to-speech language set to ${this.querySelector('span').textContent}`;
                        speechStatus.classList.add('active');
                        
                        // Demo the selected language
                        let demoPhrase = "This is a test of the text-to-speech feature.";
                        if (lang === "fil-PH") {
                            demoPhrase = "Ito ay isang pagsubok ng text-to-speech na feature.";
                        } else if (lang === "fil-en") {
                            demoPhrase = "This is a test of the text-to-speech feature, salamat po!";
                        }
                        
                        // Speak demo phrase
                        speakText(demoPhrase, lang);
                    });
                });
                
                // Demo text click handler
                demoText.addEventListener('click', function() {
                    if (activeSpeechOption) {
                        const lang = activeSpeechOption.getAttribute('data-lang');
                        speakText(this.textContent, lang);
                    } else {
                        speechStatus.textContent = "Please select a language first";
                        speechStatus.classList.add('active');
                    }
                });
                
                // Pause/Resume button
                pauseResumeBtn.addEventListener('click', function() {
                    if (synth.speaking) {
                        if (synth.paused) {
                            synth.resume();
                            this.innerHTML = '<i class="fas fa-pause"></i>';
                            speechStatus.textContent = "Speaking...";
                        } else {
                            synth.pause();
                            this.innerHTML = '<i class="fas fa-play"></i>';
                            speechStatus.textContent = "Paused";
                        }
                    }
                });
                
                // Stop button
                stopSpeechBtn.addEventListener('click', function() {
                    if (synth.speaking) {
                        synth.cancel();
                        speechStatus.textContent = "Stopped";
                        pauseResumeBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    }
                });
                
                // Volume slider
                volumeSlider.addEventListener('input', function() {
                    if (currentUtterance) {
                        currentUtterance.volume = this.value;
                    }
                });
            } else {
                // Browser doesn't support speech synthesis
                speechOptions.forEach(option => {
                    option.style.opacity = "0.5";
                    option.style.cursor = "not-allowed";
                });
                
                const speechSection = document.querySelector('.speech-options').parentNode;
                const unsupportedMessage = document.createElement('p');
                unsupportedMessage.textContent = "Your browser doesn't support text-to-speech.";
                unsupportedMessage.style.color = "var(--danger)";
                unsupportedMessage.style.marginTop = "10px";
                speechSection.appendChild(unsupportedMessage);
                
                // Hide controls
                document.querySelector('.text-speech-controls').style.display = 'none';
                demoText.style.display = 'none';
            }

            // Avatar selection
            let selectedAvatar = '1';
            avatarOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    avatarOptions.forEach(opt => opt.classList.remove('selected'));
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    // Store selected avatar
                    selectedAvatar = this.getAttribute('data-avatar');
                });
            });
            
            // Skip button - use default values
            skipButton.addEventListener('click', function() {
                // Close modal with default values
                welcomeModal.classList.remove('active');
                
                // Set default name
                userNameDisplay.textContent = 'Scholar';
                welcomeNameDisplay.textContent = 'Scholar';
                
                // Set default avatar
                userAvatarDisplay.innerHTML = '<i class="fas fa-user"></i>';
            });
            
            // Start button - use form values
            startButton.addEventListener('click', function() {
                // Basic validation
                if (userName.value.trim() === '') {
                    userName.focus();
                    userName.style.borderColor = 'var(--danger)';
                    return;
                }
                
                if (userEmail.value.trim() === '') {
                    userEmail.focus();
                    userEmail.style.borderColor = 'var(--danger)';
                    return;
                }
                
                // Get first name for display
                const name = userName.value.trim().split(' ')[0];
                
                // Update displays
                userNameDisplay.textContent = name;
                welcomeNameDisplay.textContent = name;
                
                // Set avatar based on selection
                let avatarIcon = '';
                switch(selectedAvatar) {
                    case '1':
                        avatarIcon = '<i class="fas fa-user"></i>';
                        break;
                    case '2':
                        avatarIcon = '<i class="fas fa-user-graduate"></i>';
                        break;
                    case '3':
                        avatarIcon = '<i class="fas fa-user-astronaut"></i>';
                        break;
                    case '4':
                        avatarIcon = '<i class="fas fa-user-ninja"></i>';
                        break;
                    default:
                        avatarIcon = '<i class="fas fa-user"></i>';
                }
                userAvatarDisplay.innerHTML = avatarIcon;
                
                // Apply accessibility options
                if (dyslexiaOption.checked) {
                    document.body.classList.add('dyslexia-friendly');
                }
                
                if (adhOption.checked) {
                    document.body.classList.add('focus-mode');
                }
                
                if (colorBlindOption.checked) {
                    document.body.classList.add('color-blind-friendly');
                }
                
                if (highContrastOption.checked) {
                    document.body.classList.add('high-contrast');
                }
                
                if (slowConnectionOption.checked) {
                    document.body.classList.add('slow-connection');
                    simulateSlowLoading();
                }
                
                // Add text-to-speech functionality if selected
                if (activeSpeechOption) {
                    localStorage.setItem('textToSpeechLanguage', activeSpeechOption.getAttribute('data-lang'));
                    localStorage.setItem('textToSpeechEnabled', ttsEnabledToggle.checked ? 'true' : 'false');
                    
                    // Add speech functionality to content elements after modal closes
                    setTimeout(() => {
                        enableTextToSpeechForContentElements();
                    }, 1000);
                }
                
                // Close modal
                welcomeModal.classList.remove('active');
                
                // Add welcome animation
                userProfileDisplay.classList.add('pulse');
                setTimeout(() => {
                    userProfileDisplay.classList.remove('pulse');
                }, 2000);
            });
            
            // Input event listeners
            userName.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    this.style.borderColor = '';
                }
            });
            
            userEmail.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    this.style.borderColor = '';
                }
            });
            
            // Slow connection simulation
            function simulateSlowLoading() {
                const loader = document.querySelector('.loader');
                let width = 0;
                
                const interval = setInterval(function() {
                    if (width >= 100) {
                        width = 0;
                        loader.style.width = width + '%';
                    } else {
                        width += Math.random() * 3;
                        if (width > 100) width = 100;
                        loader.style.width = width + '%';
                    }
                }, 200);
            }
            
            // Apply float animation to achievements
            const achievements = document.querySelectorAll('.achievement');
        achievements.forEach((achievement, index) => {
            setTimeout(() => {
                achievement.classList.add('float');
            }, index * 300);
        });
        // Add subject data by grade level
            const subjectData = {
                // Grade 1-3 (Primary)
                "1": {
                    english: [
                        { title: "Phonics Basics", xp: 50, coins: 10, progress: 0, status: "Not Started", description: "Learn basic letter sounds and simple word formation" },
                        { title: "Reading Comprehension", xp: 60, coins: 15, progress: 0, status: "Not Started", description: "Read short stories and answer questions" },
                        { title: "Vocabulary Building", xp: 40, coins: 10, progress: 0, status: "Not Started", description: "Learn new words and their meanings" }
                    ],
                    filipino: [
                        { title: "Alpabetong Filipino", xp: 50, coins: 10, progress: 0, status: "Not Started", description: "Pag-aaral ng mga titik at tunog" },
                        { title: "Mga Salita at Kahulugan", xp: 60, coins: 15, progress: 0, status: "Not Started", description: "Pag-aaral ng mga simpleng salita" },
                        { title: "Mga Maikling Kwento", xp: 40, coins: 10, progress: 0, status: "Not Started", description: "Pagbasa ng maikling kwento" }
                    ],
                    math: [
                        { title: "Counting Numbers", xp: 50, coins: 10, progress: 0, status: "Not Started", description: "Learn to count from 1 to 100" },
                        { title: "Basic Addition", xp: 60, coins: 15, progress: 0, status: "Not Started", description: "Learn to add numbers up to 20" },
                        { title: "Basic Subtraction", xp: 40, coins: 10, progress: 0, status: "Not Started", description: "Learn to subtract numbers up to 20" }
                    ],
                    science: [
                        { title: "Plants & Animals", xp: 50, coins: 10, progress: 0, status: "Not Started", description: "Learn about basic living things" },
                        { title: "Weather & Seasons", xp: 60, coins: 15, progress: 0, status: "Not Started", description: "Learn about weather patterns" },
                        { title: "My Body", xp: 40, coins: 10, progress: 0, status: "Not Started", description: "Learn about basic body parts and functions" }
                    ]
                },
                // Grade 4-6 (Intermediate)
                "4": {
                    english: [
                        { title: "Grammar Fundamentals", xp: 70, coins: 20, progress: 0, status: "Not Started", description: "Learn parts of speech and sentence structure" },
                        { title: "Creative Writing", xp: 80, coins: 25, progress: 0, status: "Not Started", description: "Write original short stories" },
                        { title: "Reading Analysis", xp: 75, coins: 20, progress: 0, status: "Not Started", description: "Analyze character, plot, and setting" }
                    ],
                    filipino: [
                        { title: "Mga Maikling Kwento", xp: 70, coins: 20, progress: 0, status: "Not Started", description: "Pagbasa at pag-unawa ng mga kuwento" },
                        { title: "Pagsulat ng Sanaysay", xp: 80, coins: 25, progress: 0, status: "Not Started", description: "Pagsulat ng maikling sanaysay" },
                        { title: "Mga Sawikain", xp: 75, coins: 20, progress: 0, status: "Not Started", description: "Pag-aaral ng mga sawikain at kasabihan" }
                    ],
                    math: [
                        { title: "Multiplication & Division", xp: 70, coins: 20, progress: 0, status: "Not Started", description: "Master times tables and division" },
                        { title: "Fractions", xp: 80, coins: 25, progress: 0, status: "Not Started", description: "Learn to add, subtract, and compare fractions" },
                        { title: "Measurements", xp: 75, coins: 20, progress: 0, status: "Not Started", description: "Learn to measure length, weight, and volume" }
                    ],
                    science: [
                        { title: "Earth Science", xp: 70, coins: 20, progress: 0, status: "Not Started", description: "Learn about rocks, soil, and landforms" },
                        { title: "Life Cycles", xp: 80, coins: 25, progress: 0, status: "Not Started", description: "Study plant and animal life cycles" },
                        { title: "Energy & Matter", xp: 75, coins: 20, progress: 0, status: "Not Started", description: "Explore basic physics concepts" }
                    ]
                },
                // Grade 7-10 (Junior High)
                "7": {
                    english: [
                        { title: "Literary Analysis", xp: 100, coins: 30, progress: 0, status: "Not Started", description: "Analyze themes and literary devices" },
                        { title: "Essay Writing", xp: 110, coins: 35, progress: 0, status: "Not Started", description: "Learn argumentative essay structure" },
                        { title: "Public Speaking", xp: 90, coins: 30, progress: 0, status: "Not Started", description: "Practice speeches and presentations" }
                    ],
                    filipino: [
                        { title: "Noli Me Tangere", xp: 100, coins: 30, progress: 0, status: "Not Started", description: "Pag-aaral ng nobelang Noli Me Tangere" },
                        { title: "Panitikang Pilipino", xp: 110, coins: 35, progress: 0, status: "Not Started", description: "Mga akda ng kilalang Pilipinong manunulat" },
                        { title: "Retorika", xp: 90, coins: 30, progress: 0, status: "Not Started", description: "Pag-aaral ng maayos na pagsasalita" }
                    ],
                    math: [
                        { title: "Algebra Basics", xp: 100, coins: 30, progress: 0, status: "Not Started", description: "Learn to solve for variables" },
                        { title: "Geometry", xp: 110, coins: 35, progress: 0, status: "Not Started", description: "Study shapes, angles, and theorems" },
                        { title: "Statistics", xp: 90, coins: 30, progress: 0, status: "Not Started", description: "Learn to analyze data and probability" }
                    ],
                    science: [
                        { title: "Plate Tectonics", xp: 100, coins: 30, progress: 0, status: "Not Started", description: "Study earth's crust and movements" },
                        { title: "Cell Biology", xp: 110, coins: 35, progress: 0, status: "Not Started", description: "Learn about cells and their functions" },
                        { title: "Chemical Reactions", xp: 90, coins: 30, progress: 0, status: "Not Started", description: "Study basic chemistry principles" }
                    ]
                },
                // Grade 11-12 (Senior High)
                "11": {
                    english: [
                        { title: "Research Writing", xp: 130, coins: 40, progress: 0, status: "Not Started", description: "Learn to research and cite sources" },
                        { title: "World Literature", xp: 140, coins: 45, progress: 0, status: "Not Started", description: "Study important global literary works" },
                        { title: "Critical Analysis", xp: 120, coins: 40, progress: 0, status: "Not Started", description: "Develop critical thinking skills" }
                    ],
                    filipino: [
                        { title: "Kontemporaryong Panitikan", xp: 130, coins: 40, progress: 0, status: "Not Started", description: "Modernong akda at sining" },
                        { title: "El Filibusterismo", xp: 140, coins: 45, progress: 0, status: "Not Started", description: "Pag-aaral ng nobelang El Filibusterismo" },
                        { title: "Malikhaing Pagsulat", xp: 120, coins: 40, progress: 0, status: "Not Started", description: "Pagsulat ng iba't ibang uri ng akda" }
                    ],
                    math: [
                        { title: "Trigonometry", xp: 130, coins: 40, progress: 0, status: "Not Started", description: "Learn about trigonometric functions" },
                        { title: "Calculus", xp: 140, coins: 45, progress: 0, status: "Not Started", description: "Study derivatives and integrals" },
                        { title: "Advanced Algebra", xp: 120, coins: 40, progress: 0, status: "Not Started", description: "Work with complex equations" }
                    ],
                    science: [
                        { title: "Physics", xp: 130, coins: 40, progress: 0, status: "Not Started", description: "Study forces, energy, and motion" },
                        { title: "Advanced Biology", xp: 140, coins: 45, progress: 0, status: "Not Started", description: "Learn about genetics and ecosystems" },
                        { title: "Chemistry", xp: 120, coins: 40, progress: 0, status: "Not Started", description: "Study matter, reactions, and compounds" }
                    ]
                }
            };
            
            // Function to get subject data for selected grade
            function getSubjectDataForGrade(grade) {
                // Default to grade 7 if not found
                if (!subjectData[grade]) {
                    // Find closest available grade
                    const grades = Object.keys(subjectData).map(Number).sort((a, b) => a - b);
                    let closestGrade = grades[0];
                    for (const g of grades) {
                        if (g <= grade) {
                            closestGrade = g;
                        } else {
                            break;
                        }
                    }
                    return subjectData[closestGrade];
                }
                return subjectData[grade];
            }
            function optimizeModalScroll() {
    const modalContent = document.querySelector('.modal-content');
    
    // Use passive event listener
    modalContent.addEventListener('scroll', function(e) {
        // Use requestAnimationFrame for smoother performance
        requestAnimationFrame(() => {
            const scrollPosition = modalContent.scrollTop;
            const totalScrollHeight = modalContent.scrollHeight - modalContent.clientHeight;
            const scrollPercentage = Math.min(Math.round((scrollPosition / totalScrollHeight) * 100), 100);
            
            const progressBar = modalContent.querySelector('#lessonProgressBar');
            const progressText = modalContent.querySelector('#lessonProgressText');
            
            if (progressBar && progressText) {
                progressBar.style.width = `${scrollPercentage}%`;
                progressText.textContent = `${scrollPercentage}%`;
            }
        });
    }, { passive: true });
}
            // Function to update subject cards based on grade
            function updateSubjectCards(grade) {
                const data = getSubjectDataForGrade(grade);
                
                // Update English
                updateSubjectCard('english', data.english[0]);
                
                // Update Filipino
                updateSubjectCard('filipino', data.filipino[0]);
                
                // Update Math
                updateSubjectCard('math', data.math[0]);
                
                // Update Science
                updateSubjectCard('science', data.science[0]);
                
                // Store all subjects data for this grade
                window.currentGradeData = data;
            }
            
            // Function to update a specific subject card
            function updateSubjectCard(subject, topicData) {
                const card = document.querySelector(`.subject-card .${subject}-bg`).parentElement;
                const titleElement = card.querySelector('h3');
                const descriptionElement = card.querySelector('p');
                const progressElement = card.querySelector('.progress-fill');
                const progressTextElement = card.querySelector('.progress-info span:last-child');
                const xpElement = card.querySelector('.reward-item:first-child span');
                const coinsElement = card.querySelector('.reward-item:last-child span');
                const statusElement = card.querySelector('.quest-status');
                
                // Update content
                titleElement.nextElementSibling.textContent = topicData.title;
                descriptionElement.textContent = topicData.description;
                progressElement.style.width = topicData.progress + '%';
                progressTextElement.textContent = topicData.progress + '%';
                xpElement.textContent = topicData.xp + ' XP';
                coinsElement.textContent = topicData.coins;
                statusElement.textContent = topicData.status;
                
                // Make the continue button interactive
                const continueButton = modal.querySelector('#completeLesson');
    continueButton.addEventListener('click', function(e) {
        e.preventDefault();
        const subject = this.getAttribute('data-subject');
        const title = this.getAttribute('data-title');
        
        // Map subject to correct HTML file
        const subjectPages = {
            'english': 'english.html',
            'filipino': 'filipino.html',
            'math': 'math.html',
            'science': 'science.html'
        };
        
        // Redirect to the specific subject page
        if (subjectPages[subject]) {
            window.location.href = `Subjects/${subjectPages[subject]}`;
        }
    });
    
    // Add event listeners for other buttons
    modal.querySelector('.close-modal').addEventListener('click', function() {
        modal.classList.remove('active');
    });
    
    modal.querySelector('#closeLesson').addEventListener('click', function() {
        modal.classList.remove('active');
    });
    
    return modal;
}
            
            
            // Create lesson modal
            function createLessonModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.id = 'lessonModal';
                
                modal.innerHTML = `
                    <div class="modal" style="max-width: 700px;">
                        <div class="modal-header">
                            <div class="modal-title">Lesson Content</div>
                            <button class="close-modal">&times;</button>
                        </div>
                        <div class="modal-content" style="max-height: 60vh; overflow-y: auto;">
                            <div id="lessonContent">
                                <!-- Content will be inserted here -->
                            </div>
                            <div class="progress-section" style="margin-top: 20px;">
                                <div class="progress-info">
                                    <span>Lesson Progress</span>
                                    <span id="lessonProgressText">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="lessonProgressBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn btn-secondary" id="closeLesson">Back to Dashboard</button>
                            <button class="modal-btn btn-primary" id="completeLesson">Continue to Lesson</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Add event listeners
                modal.querySelector('.close-modal').addEventListener('click', function() {
                    modal.classList.remove('active');
                });
                
                modal.querySelector('#closeLesson').addEventListener('click', function() {
                    modal.classList.remove('active');
                });
                
                modal.querySelector('#completeLesson').addEventListener('click', function(e) {
                    e.preventDefault();
                    modal.classList.remove('active');
                });
                
                return modal;
            }
            
            // Show lesson modal with content
            function showLessonModal(subject, topicData) {
                let lessonModal = document.getElementById('lessonModal');
    if (!lessonModal) {
        lessonModal = createLessonModal();
        document.body.appendChild(lessonModal);
    }
                
                // Set attributes for tracking
                const continueButton = lessonModal.querySelector('#completeLesson');
    continueButton.setAttribute('data-subject', subject);
    continueButton.setAttribute('data-title', topicData.title);
                
                // Get content element
                const contentElement = lessonModal.querySelector('#lessonContent');
                
                // Generate content based on subject and topic
                let content = '';
                switch(subject) {
                    case 'english':
                        content = generateEnglishContent(topicData);
                        break;
                    case 'filipino':
                        content = generateFilipinoContent(topicData);
                        break;
                    case 'math':
                        content = generateMathContent(topicData);
                        break;
                    case 'science':
                        content = generateScienceContent(topicData);
                        break;
                }
                
                // Set content
                contentElement.innerHTML = content;
                
                // Reset progress
                lessonModal.querySelector('#lessonProgressBar').style.width = '0%';
                lessonModal.querySelector('#lessonProgressText').textContent = '0%';
                
                // Show modal
                lessonModal.classList.add('active');
                
                // Simulate progress as user scrolls
                const modalContent = lessonModal.querySelector('.modal-content');
                modalContent.addEventListener('scroll', function() {
                    const scrollPosition = modalContent.scrollTop;
                    const totalScrollHeight = modalContent.scrollHeight - modalContent.clientHeight;
                    const scrollPercentage = Math.min(Math.round((scrollPosition / totalScrollHeight) * 100), 100);
                    
                    lessonModal.querySelector('#lessonProgressBar').style.width = scrollPercentage + '%';
                    lessonModal.querySelector('#lessonProgressText').textContent = scrollPercentage + '%';
                    
                    // Enable complete button if scrolled more than 70%
                    if (scrollPercentage > 70) {
                        lessonModal.querySelector('#completeLesson').disabled = false;
                    }
                });
                
                // Initially disable complete button
                lessonModal.querySelector('#completeLesson').disabled = true;
            }
            
            // Complete a lesson
            function completeLesson(subject, title) {
                // Find the subject and topic in current grade data
                const data = window.currentGradeData;
                let topicIndex = -1;
                
                for (let i = 0; i < data[subject].length; i++) {
                    if (data[subject][i].title === title) {
                        topicIndex = i;
                        break;
                    }
                }
                
                if (topicIndex !== -1) {
                    // Update progress and status
                    data[subject][topicIndex].progress = 100;
                    data[subject][topicIndex].status = "Completed";
                    
                    // Update the card
                    updateSubjectCard(subject, data[subject][topicIndex]);
                    
                    // Add to activity feed
                    addActivity(subject, title, data[subject][topicIndex].xp, data[subject][topicIndex].coins);
                    
                    // Update user stats
                    updateUserStats(data[subject][topicIndex].xp, data[subject][topicIndex].coins);
                    
                    // Show next topic if available
                    if (topicIndex < data[subject].length - 1) {
                        // Update to next topic
                        updateSubjectCard(subject, data[subject][topicIndex + 1]);
                    }
                }
            }
            
            // Update user stats
            function updateUserStats(xp, coins) {
                const xpElement = document.querySelector('.user-stats .stat:first-child .stat-value');
                const coinsElement = document.querySelector('.user-stats .stat:nth-child(2) .stat-value');
                
                let currentXP = parseInt(xpElement.textContent) || 0;
                let currentCoins = parseInt(coinsElement.textContent) || 0;
                
                // Add new values
                currentXP += xp;
                currentCoins += coins;
                
                // Update display
                xpElement.textContent = currentXP.toLocaleString() + ' XP';
                coinsElement.textContent = currentCoins;
                
                // Animate
                xpElement.parentElement.classList.add('pulse');
                coinsElement.parentElement.classList.add('pulse');
                
                setTimeout(() => {
                    xpElement.parentElement.classList.remove('pulse');
                    coinsElement.parentElement.classList.remove('pulse');
                }, 2000);
            }
            
            // Add activity to feed
            function addActivity(subject, title, xp, coins) {
                const activityList = document.querySelector('.activity-list');
                const newActivity = document.createElement('div');
                newActivity.className = 'activity-item';
                
                newActivity.innerHTML = `
                    <div class="activity-icon ${subject}-activity">
                        <i class="fas ${getSubjectIcon(subject)}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">Completed ${title}</div>
                        <div class="activity-details">
                            <div class="activity-time">Just now</div>
                            <div class="activity-rewards">
                                <div class="xp-reward">
                                    <i class="fas fa-bolt"></i>
                                    <span>${xp} XP</span>
                                </div>
                                <div class="coin-reward">
                                    <i class="fas fa-coins"></i>
                                    <span>${coins}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add to top of list
                if (activityList.firstChild) {
                    activityList.insertBefore(newActivity, activityList.firstChild);
                } else {
                    activityList.appendChild(newActivity);
                }
                
                // Limit to 5 activities
                if (activityList.children.length > 5) {
                    activityList.removeChild(activityList.lastChild);
                }
                
                // Animation
                newActivity.style.opacity = '0';
                newActivity.style.transform = 'translateY(-20px)';
                
                setTimeout(() => {
                    newActivity.style.transition = 'all 0.5s ease';
                    newActivity.style.opacity = '1';
                    newActivity.style.transform = 'translateY(0)';
                }, 100);
            }
            
            // Get icon for subject
            function getSubjectIcon(subject) {
                switch(subject) {
                    case 'english': return 'fa-book';
                    case 'filipino': return 'fa-pen';
                    case 'math': return 'fa-calculator';
                    case 'science': return 'fa-flask';
                    default: return 'fa-file';
                }
            }
            
            // Generate content for each subject
            function generateEnglishContent(topicData) {
                return `
                    <h2>${topicData.title}</h2>
                    <p>${topicData.description}</p>
                    <div style="margin: 20px 0;">
                        <h3>Learning Objectives</h3>
                        <ul>
                            <li>Understand key concepts related to ${topicData.title.toLowerCase()}</li>
                            <li>Develop critical thinking skills through analysis and interpretation</li>
                            <li>Apply language concepts in practical contexts</li>
                        </ul>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Key Concepts</h3>
                        <p>This lesson covers important English language and literature concepts that will help you communicate effectively and analyze texts with deeper understanding.</p>
                        <p>English helps us develop critical thinking skills and express our ideas clearly and persuasively.</p>
                        <p>Through consistent practice and application, you'll improve your reading comprehension, writing, and analytical abilities.</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Practice Activities</h3>
                        <p>Complete these activities to reinforce your learning:</p>
                        <ol>
                            <li>Read the provided text and identify the main themes</li>
                            <li>Write a short response analyzing the author's techniques</li>
                            <li>Complete the vocabulary exercises</li>
                            <li>Participate in the group discussion</li>
                        </ol>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Additional Resources</h3>
                        <p>Explore these resources to deepen your understanding:</p>
                        <ul>
                            <li>Interactive grammar exercises</li>
                            <li>Recommended reading list</li>
                            <li>Video tutorials on literary analysis</li>
                        </ul>
                    </div>
                `;
            }
            
            function generateFilipinoContent(topicData) {
                return `
                    <h2>${topicData.title}</h2>
                    <p>${topicData.description}</p>
                    <div style="margin: 20px 0;">
                        <h3>Mga Layunin sa Pagkatuto</h3>
                        <ul>
                            <li>Maunawaan ang mahahalagang konsepto tungkol sa ${topicData.title.toLowerCase()}</li>
                            <li>Mapaunlad ang kakayahan sa pag-iisip at pagsusuri</li>
                            <li>Makapagsanay sa paggamit ng wikang Filipino</li>
                        </ul>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Mahahalagang Konsepto</h3>
                        <p>Ang araling ito ay sumasaklaw sa mahahalagang konsepto ng wika at panitikang Filipino na tutulong sa iyong maunawaan ang ating kultura at pagkakakilanlan.</p>
                        <p>Ang wikang Filipino ay nagsisilbing instrumento ng pambansang pagkakaisa at pagpapahayag ng ating kulturang Pilipino.</p>
                        <p>Sa pamamagitan ng patuloy na pagsasanay at pag-aaral, mapapaunlad mo ang iyong kakayahan sa pagbasa, pagsulat, at pag-unawa ng wikang Filipino.</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Mga Gawain</h3>
                        <p>Kumpletuhin ang mga sumusunod na gawain:</p>
                        <ol>
                            <li>Basahin ang teksto at tukuyin ang pangunahing tema</li>
                            <li>Sumulat ng maikling reaksyon tungkol sa binasa</li>
                            <li>Kumpletuhin ang mga pagsasanay sa bokabularyo</li>
                            <li>Makilahok sa talakayan ng grupo</li>
                        </ol>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Karagdagang Sanggunian</h3>
                        <p>Tuklasin ang mga sumusunod na sanggunian:</p>
                        <ul>
                            <li>Mga interaktibong pagsasanay sa gramatika</li>
                            <li>Listahan ng mga inirerekomendang babasahin</li>
                            <li>Mga video tungkol sa panitikang Pilipino</li>
                        </ul>
                    </div>
                `;
            }
            
            function generateMathContent(topicData) {
                return `
                    <h2>${topicData.title}</h2>
                    <p>${topicData.description}</p>
                    <div style="margin: 20px 0;">
                        <h3>Learning Objectives</h3>
                        <ul>
                            <li>Understand key mathematical concepts related to ${topicData.title.toLowerCase()}</li>
                            <li>Develop problem-solving skills through practice</li>
                            <li>Apply mathematical concepts to real-world situations</li>
                        </ul>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Key Concepts</h3>
                        <p>This lesson covers important mathematical principles that form the foundation for more advanced concepts.</p>
                        <p>Mathematics helps us understand patterns, solve problems, and make informed decisions based on quantitative information.</p>
                        <p>Through regular practice and application, you'll develop stronger analytical and logical reasoning skills.</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Practice Problems</h3>
                        <p>Solve these problems to reinforce your learning:</p>
                        <ol>
                            <li>Problem 1: Apply the concept to find the solution</li>
                            <li>Problem 2: Work through this step-by-step example</li>
                            <li>Problem 3: Challenge yourself with this application</li>
                            <li>Problem 4: Analyze this real-world scenario</li>
                        </ol>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Additional Resources</h3>
                        <p>Explore these resources to deepen your understanding:</p>
                        <ul>
                            <li>Interactive practice exercises</li>
                            <li>Video tutorials on problem-solving techniques</li>
                            <li>Real-world applications of ${topicData.title.toLowerCase()}</li>
                        </ul>
                    </div>
                `;
            }
            
            function generateScienceContent(topicData) {
                return `
                    <h2>${topicData.title}</h2>
                    <p>${topicData.description}</p>
                    <div style="margin: 20px 0;">
                        <h3>Learning Objectives</h3>
                        <ul>
                            <li>Understand key scientific concepts related to ${topicData.title.toLowerCase()}</li>
                            <li>Develop scientific inquiry and critical thinking skills</li>
                            <li>Apply scientific principles to explain natural phenomena</li>
                        </ul>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Key Concepts</h3>
                        <p>This lesson explores important scientific principles that help us understand the world around us.</p>
                        <p>Science empowers us to make evidence-based decisions and solve complex problems through systematic investigation.</p>
                        <p>Through observation, experimentation, and analysis, you'll develop a deeper understanding of natural phenomena.</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Investigations and Activities</h3>
                        <p>Complete these activities to reinforce your learning:</p>
                        <ol>
                            <li>Observe and record data related to the topic</li>
                            <li>Conduct a simple experiment to test a hypothesis</li>
                            <li>Analyze provided data and draw conclusions</li>
                            <li>Research and report on a related scientific discovery</li>
                        </ol>
                    </div>
                    <div style="margin: 20px 0;">
                        <h3>Additional Resources</h3>
                        <p>Explore these resources to deepen your understanding:</p>
                        <ul>
                            <li>Interactive simulations and models</li>
                            <li>Video demonstrations of scientific principles</li>
                            <li>Articles on recent discoveries in this field</li>
                        </ul>
                    </div>
                `;
            }
            
            // Grade level change handler
            gradeLevel.addEventListener('change', function() {
                if (this.value) {
                    updateSubjectCards(this.value);
                }
            });
            
            // Skip button - use default values
            skipButton.addEventListener('click', function() {
                // Close modal with default values
                welcomeModal.classList.remove('active');
                
                // Set default name
                userNameDisplay.textContent = 'Scholar';
                welcomeNameDisplay.textContent = 'Scholar';
                
                // Set default avatar
                userAvatarDisplay.innerHTML = '<i class="fas fa-user"></i>';
                
                // Set default grade level (Grade 7)
                updateSubjectCards('7');
            });
            
            // Start button - use form values
            startButton.addEventListener('click', function() {
                // Basic validation
                if (userName.value.trim() === '') {
                    userName.focus();
                    userName.style.borderColor = 'var(--danger)';
                    return;
                }
                
                if (userEmail.value.trim() === '') {
                    userEmail.focus();
                    userEmail.style.borderColor = 'var(--danger)';
                    return;
                }
                
                // Get first name for display
                const name = userName.value.trim().split(' ')[0];
                
                // Update displays
                userNameDisplay.textContent = name;
                welcomeNameDisplay.textContent = name;
                
                // Set avatar based on selection
                let avatarIcon = '';
                switch(selectedAvatar) {
                    case '1':
                        avatarIcon = '<i class="fas fa-user"></i>';
                        break;
                    case '2':
                        avatarIcon = '<i class="fas fa-user-graduate"></i>';
                        break;
                    case '3':
                        avatarIcon = '<i class="fas fa-user-astronaut"></i>';
                        break;
                    case '4':
                        avatarIcon = '<i class="fas fa-user-ninja"></i>';
                        break;
                    default:
                        avatarIcon = '<i class="fas fa-user"></i>';
                }
                userAvatarDisplay.innerHTML = avatarIcon;
                
                // Update subjects based on grade level
                if (gradeLevel.value) {
                    updateSubjectCards(gradeLevel.value);
                } else {
                    // Default to grade 7 if not selected
                    updateSubjectCards('7');
                }
                
                // Apply accessibility options
                if (dyslexiaOption.checked) {
                    document.body.classList.add('dyslexia-friendly');
                }
                
                if (adhOption.checked) {
                    document.body.classList.add('focus-mode');
                }
                
                if (colorBlindOption.checked) {
                    document.body.classList.add('color-blind-friendly');
                }
                
                if (highContrastOption.checked) {
                    document.body.classList.add('high-contrast');
                }
                
                if (slowConnectionOption.checked) {
                    document.body.classList.add('slow-connection');
                    simulateSlowLoading();
                }
                
                // Add text-to-speech functionality if selected
                if (activeSpeechOption) {
                    localStorage.setItem('textToSpeechLanguage', activeSpeechOption.getAttribute('data-lang'));
                    
                    // Add speech functionality to content elements after modal closes
                    setTimeout(() => {
                        const contentElements = document.querySelectorAll('h1, h2, h3, p, .quest-button, .activity-title');
                        
                        contentElements.forEach(element => {
                            element.addEventListener('click', function(e) {
                                // Check if not a link or button internal click
                                if (e.target === this || !this.querySelector('a, button')) {
                                    const lang = activeSpeechOption.getAttribute('data-lang');
                                    speakText(this.textContent, lang);
                                    
                                    // Add highlight effect
                                    this.classList.add('text-to-speech-highlight');
                                    setTimeout(() => {
                                        this.classList.remove('text-to-speech-highlight');
                                    }, 300);
                                }
                            });
                            
                            // Add visual cue that text is clickable
                            element.style.cursor = 'pointer';
                            element.title = 'Click to hear this text read aloud';
                        });
                    }, 1000);
                }
                
                // Close modal
                welcomeModal.classList.remove('active');
                
                // Add welcome animation
                userProfileDisplay.classList.add('pulse');
                setTimeout(() => {
                    userProfileDisplay.classList.remove('pulse');
                }, 2000);
            });
            
            // Input event listeners
            userName.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    this.style.borderColor = '';
                }
            });
            
            userEmail.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    this.style.borderColor = '';
                }
            });
            
            // Slow connection simulation
            function simulateSlowLoading() {
                const loader = document.querySelector('.loader');
                let width = 0;
                
                const interval = setInterval(function() {
                    if (width >= 100) {
                        width = 0;
                        loader.style.width = width + '%';
                    } else {
                        width += Math.random() * 3;
                        if (width > 100) width = 100;
                        loader.style.width = width + '%';
                    }
                }, 200);
            }
            
            // Chatbot Elements
            const chatbotContainer = document.getElementById('chatbotContainer');
            const chatbotToggle = document.getElementById('chatbotToggle');
            const chatbotWindow = document.getElementById('chatbotWindow');
            const chatbotClose = document.getElementById('chatbotClose');
            const chatbotMessages = document.querySelector('.chatbot-messages');
            const chatbotSuggestions = document.querySelector('.chatbot-suggestions');

            // Chatbot Toggle Functionality
            chatbotToggle.addEventListener('click', () => {
                chatbotWindow.classList.toggle('hidden');
                if (!chatbotWindow.classList.contains('hidden')) {
                    populateSuggestions(); // Populate suggestions when opening
                }
            });

            chatbotClose.addEventListener('click', () => {
                chatbotWindow.classList.add('hidden');
            });

            // Function to add a message to the chat
            function addChatMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', sender === 'bot' ? 'bot-message' : 'user-message');
                messageDiv.textContent = text;
                chatbotMessages.appendChild(messageDiv);
                // Scroll to the bottom
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }

            // Function to populate suggestions based on current subjects
            function populateSuggestions() {
                chatbotSuggestions.innerHTML = ''; // Clear existing suggestions
                if (window.currentGradeData) { // Check if grade data exists
                    const subjects = Object.keys(window.currentGradeData);
                    subjects.forEach(subject => {
                        const topicData = window.currentGradeData[subject].find(topic => topic.status !== 'Completed'); // Find the first non-completed topic
                        if (topicData) {
                            const suggestionBtn = document.createElement('button');
                            suggestionBtn.classList.add('suggestion-btn');
                            suggestionBtn.textContent = `Tell me about ${subject}: ${topicData.title}`; 
                            suggestionBtn.addEventListener('click', () => {
                                // Simulate user clicking the suggestion
                                addChatMessage(suggestionBtn.textContent, 'user');
                                // Simulate bot response (replace with actual AI logic later)
                                setTimeout(() => {
                                    const botResponse = `Let's explore ${subject}! ${topicData.description}. Would you like to start the lesson?`;
                                    addChatMessage(botResponse, 'bot');
                                    // Optionally add a 'Start Lesson' button here
                                }, 500);
                            });
                            chatbotSuggestions.appendChild(suggestionBtn);
                        }
                    });
                } else {
                    // Default suggestions if no grade data yet
                    const defaultSuggestions = ['What is English?', 'What is Math?', 'How do I earn XP?'];
                    defaultSuggestions.forEach(text => {
                         const suggestionBtn = document.createElement('button');
                            suggestionBtn.classList.add('suggestion-btn');
                            suggestionBtn.textContent = text;
                            suggestionBtn.addEventListener('click', () => {
                                addChatMessage(suggestionBtn.textContent, 'user');
                                // Basic bot response
                                setTimeout(() => {
                                    addChatMessage(`I can help you with that. Let's look into ${text}.`, 'bot');
                                }, 500);
                            });
                            chatbotSuggestions.appendChild(suggestionBtn);
                    });
                }
            }
                 // Text-to-Speech Functionality
    function initTextToSpeech() {
        const synth = window.speechSynthesis;
        let voices = [];
        
        // Get available voices
        function loadVoices() {
            voices = synth.getVoices();
        }
        
        // Chrome needs this to be called explicitly
        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        
        // Initial load of voices
        loadVoices();
        
        // Helper function to find the best voice for a language
        function findVoice(lang) {
            // Look for exact match first
            let exactMatch = voices.find(voice => voice.lang === lang);
            if (exactMatch) return exactMatch;
            
            // Look for partial match (e.g., 'en-US' would match with 'en')
            let partialMatch = voices.find(voice => voice.lang.substring(0, 2) === lang.substring(0, 2));
            if (partialMatch) return partialMatch;
            
            // Default to first available voice
            return voices[0];
        }
        
        // Enhanced speak text function with language support
        function speakText(text, lang = 'en-US') {
            const utterance = new SpeechSynthesisUtterance(text);
            
            // Set language based on selection
            if (lang === "fil-en") {
                // For Taglish, we use English voice but with some modifications
                utterance.voice = findVoice("en-US");
                utterance.rate = 0.9; // Slightly slower for Taglish
            } else if (lang === "fil-PH") {
                utterance.voice = findVoice("fil-PH");
                // If Filipino voice not available, use English but slower
                if (utterance.voice.lang.substring(0, 2) !== "fi") {
                    utterance.rate = 0.8;
                }
            } else {
                utterance.voice = findVoice(lang);
            }
            
            synth.speak(utterance);
            
            return utterance;
        }

        // Add to modal continue buttons
        document.querySelectorAll('.continue-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const text = btn.getAttribute('data-speech') || 'Continuing to the next lesson';
                const lang = btn.getAttribute('data-lang') || 'en-US';
                speakText(text, lang);
            });
        });
        
        // Make the speakText function available globally
        window.speakText = speakText;
        
        return {
            speak: speakText,
            voices: () => voices,
            synth: synth
        };
    }

    // Theme Toggle Logic
    function initThemeToggle() {
        const themeToggle = document.getElementById('themeToggle');
        const savedTheme = localStorage.getItem('pilarTheme') || 'dark';
        
        function applyTheme(theme) {
            document.body.classList.toggle('light-mode', theme === 'light');
            localStorage.setItem('pilarTheme', theme);
        }

        // Initial theme application
        applyTheme(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.body.classList.contains('light-mode') ? 'dark' : 'light';
            applyTheme(currentTheme);
        });
    }

    // Add tooltips to accessibility options
    function addAccessibilityTooltips() {
        const accessibilityOptions = document.querySelectorAll('.checkbox-option');
        accessibilityOptions.forEach(option => {
            const tooltip = option.getAttribute('title');
            if (tooltip) {
                option.addEventListener('mouseenter', function() {
                    const tooltipEl = document.createElement('div');
                    tooltipEl.className = 'tooltip';
                    tooltipEl.textContent = tooltip;
                    tooltipEl.style.position = 'absolute';
                    tooltipEl.style.background = document.body.classList.contains('light-mode') ? 
                        'rgba(37, 99, 235, 0.9)' : 'rgba(0, 0, 0, 0.8)';
                    tooltipEl.style.color = 'white';
                    tooltipEl.style.padding = '5px 10px';
                    tooltipEl.style.borderRadius = '5px';
                    tooltipEl.style.maxWidth = '200px';
                    tooltipEl.style.fontSize = '0.8rem';
                    tooltipEl.style.zIndex = '200';
                    
                    this.appendChild(tooltipEl);
                    
                    const rect = this.getBoundingClientRect();
                    tooltipEl.style.top = '-30px';
                    tooltipEl.style.left = '20px';
                });
                
                option.addEventListener('mouseleave', function() {
                    const tooltip = this.querySelector('.tooltip');
                    if (tooltip) {
                        tooltip.remove();
                    }
                });
            }
        });
    }

    // Initialize speech options
    function initSpeechOptions() {
        // Check if browser supports speech synthesis
        if ('speechSynthesis' in window) {
            const speechOptions = document.querySelectorAll('.speech-option');
            const speechStatus = document.getElementById('speechStatus');
            const demoText = document.getElementById('demoText');
            const pauseResumeBtn = document.getElementById('pauseResumeBtn');
            const stopSpeechBtn = document.getElementById('stopSpeechBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            let activeSpeechOption = null;
            let currentUtterance = null;
            
            // Add click events to speech options
            speechOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    
                    // Reset active option
                    if (activeSpeechOption) {
                        activeSpeechOption.classList.remove('active');
                    }
                    
                    // Set new active option
                    this.classList.add('active');
                    activeSpeechOption = this;
                    
                    // Store preference
                    localStorage.setItem('textToSpeechLanguage', lang);
                    
                    // Update status
                    speechStatus.textContent = `Text-to-speech language set to ${this.querySelector('span').textContent}`;
                    speechStatus.classList.add('active');
                    
                    // Demo the selected language
                    let demoPhrase = "This is a test of the text-to-speech feature.";
                    if (lang === "fil-PH") {
                        demoPhrase = "Ito ay isang pagsubok ng text-to-speech na feature.";
                    } else if (lang === "fil-en") {
                        demoPhrase = "This is a test of the text-to-speech feature, salamat po!";
                    }
                    
                    // Speak demo phrase
                    window.speakText(demoPhrase, lang);
                });
            });
            
            // Demo text click handler
            if (demoText) {
                demoText.addEventListener('click', function() {
                    if (activeSpeechOption) {
                        const lang = activeSpeechOption.getAttribute('data-lang');
                        window.speakText(this.textContent, lang);
                    } else {
                        speechStatus.textContent = "Please select a language first";
                        speechStatus.classList.add('active');
                    }
                });
            }
            
            // Make speech option variable globally available
            window.activeSpeechOption = activeSpeechOption;
        } else {
            const speechOptions = document.querySelectorAll('.speech-option');
            const speechSection = document.querySelector('.speech-options')?.parentNode;
            const demoText = document.getElementById('demoText');
            
            if (speechSection) {
                // Disable speech options
                speechOptions.forEach(option => {
                    option.style.opacity = "0.5";
                    option.style.cursor = "not-allowed";
                });
                
                // Create and add warning message
                const unsupportedMessage = document.createElement('p');
                unsupportedMessage.textContent = "Your browser doesn't support text-to-speech.";
                unsupportedMessage.style.color = "var(--danger)";
                unsupportedMessage.style.marginTop = "10px";
                speechSection.appendChild(unsupportedMessage);
                
                // Hide controls
                document.querySelector('.text-speech-controls').style.display = 'none';
                if (demoText) demoText.style.display = 'none';
            }
        }
    }
    
    // Initialize all features when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        initTextToSpeech();
        initThemeToggle();
        addAccessibilityTooltips();
        initSpeechOptions();
    });

    // Function to enable TTS for content elements
    function enableTextToSpeechForContentElements() {
        const contentElements = document.querySelectorAll('h1, h2, h3, p, .quest-button, .activity-title');
        const ttsEnabled = localStorage.getItem('textToSpeechEnabled') === 'true';
        
        contentElements.forEach(element => {
            // Remove existing click listeners
            element.removeEventListener('click', handleTTSClick);
            
            // Add click listener if TTS is enabled
            if (ttsEnabled) {
                element.addEventListener('click', handleTTSClick);
                element.style.cursor = 'pointer';
                element.title = 'Click to hear this text read aloud';
            } else {
                element.style.cursor = '';
                element.title = '';
            }
        });
    }
    
    // Handle TTS click function
    function handleTTSClick(e) {
        // Prevent default for buttons and links
        if (this.tagName === 'BUTTON' || this.tagName === 'A' || this.classList.contains('quest-button')) {
            return; // Let the default action happen
        }
        
        // Prevent default for clicks inside buttons or links
        if (e.target.closest('button') || e.target.closest('a') || e.target.closest('.quest-button')) {
            return;
        }
        
        // Otherwise speak the text
        if (activeSpeechOption) {
            const lang = activeSpeechOption.getAttribute('data-lang');
            speakText(this.textContent, lang);
            
            // Add highlight effect
            this.classList.add('text-to-speech-highlight');
            setTimeout(() => {
                this.classList.remove('text-to-speech-highlight');
            }, 300);
        }
    }

    // Initialize floating TTS button
    document.addEventListener('DOMContentLoaded', function() {
        const ttsToggleBtn = document.getElementById('ttsToggleBtn');
        const ttsLanguageDropdown = document.getElementById('ttsLanguageDropdown');
        const ttsControls = document.getElementById('ttsControls');
        const ttsPauseBtn = document.getElementById('ttsPauseBtn');
        const ttsStopBtn = document.getElementById('ttsStopBtn');
        const ttsLanguageBtn = document.getElementById('ttsLanguageBtn');
        const ttsLanguageOptions = document.querySelectorAll('.tts-language-option');
        
        if (ttsToggleBtn) {
            // Get TTS state from localStorage
            const ttsEnabled = localStorage.getItem('textToSpeechEnabled') === 'true';
            ttsToggleBtn.classList.toggle('active', ttsEnabled);
            
            // Show/hide controls based on initial state
            if (ttsControls) {
                ttsControls.classList.toggle('show', ttsEnabled);
            }
            
            // Toggle TTS functionality
            ttsToggleBtn.addEventListener('click', function() {
                const isEnabled = !this.classList.contains('active');
                this.classList.toggle('active', isEnabled);
                localStorage.setItem('textToSpeechEnabled', isEnabled ? 'true' : 'false');
                
                // Update checkbox in modal if it exists
                const ttsEnabledToggle = document.getElementById('ttsEnabledToggle');
                if (ttsEnabledToggle) {
                    ttsEnabledToggle.checked = isEnabled;
                    const ttsToggleStatus = document.getElementById('ttsToggleStatus');
                    if (ttsToggleStatus) {
                        ttsToggleStatus.textContent = isEnabled ? 'Text-to-Speech Enabled' : 'Text-to-Speech Disabled';
                    }
                }
                
                // Show/hide controls
                if (ttsControls) {
                    ttsControls.classList.toggle('show', isEnabled);
                }
                
                // Update clickable elements
                enableTextToSpeechForContentElements();
            });
            
            // Language button toggle dropdown
            if (ttsLanguageBtn && ttsLanguageDropdown) {
                ttsLanguageBtn.addEventListener('click', function() {
                    ttsLanguageDropdown.classList.toggle('show');
                });
                
                // Language options handling
                ttsLanguageOptions.forEach(option => {
                    option.addEventListener('click', function() {
                        // Update active class
                        ttsLanguageOptions.forEach(opt => opt.classList.remove('active'));
                        this.classList.add('active');
                        
                        // Save the selection
                        const lang = this.getAttribute('data-lang');
                        localStorage.setItem('textToSpeechLanguage', lang);
                        
                        // Hide dropdown
                        ttsLanguageDropdown.classList.remove('show');
                    });
                });
                
                // Initialize selected language
                const savedLang = localStorage.getItem('textToSpeechLanguage');
                if (savedLang) {
                    ttsLanguageOptions.forEach(opt => {
                        if (opt.getAttribute('data-lang') === savedLang) {
                            opt.classList.add('active');
                        } else {
                            opt.classList.remove('active');
                        }
                    });
                }
            }
            
            // Stop button functionality
            if (ttsStopBtn) {
                ttsStopBtn.addEventListener('click', function() {
                    if ('speechSynthesis' in window) {
                        window.speechSynthesis.cancel();
                    }
                });
            }
            
            // Pause/Resume button functionality
            if (ttsPauseBtn) {
                ttsPauseBtn.addEventListener('click', function() {
                    if ('speechSynthesis' in window) {
                        if (window.speechSynthesis.speaking) {
                            if (window.speechSynthesis.paused) {
                                window.speechSynthesis.resume();
                                this.innerHTML = '<i class="fas fa-pause"></i>';
                            } else {
                                window.speechSynthesis.pause();
                                this.innerHTML = '<i class="fas fa-play"></i>';
                            }
                        }
                    }
                });
            }
            
            // Click outside to close language dropdown
            document.addEventListener('click', function(e) {
                if (ttsLanguageDropdown && ttsLanguageDropdown.classList.contains('show') && 
                    !e.target.closest('#ttsLanguageDropdown') && 
                    !e.target.closest('#ttsLanguageBtn')) {
                    ttsLanguageDropdown.classList.remove('show');
                }
            });
        }
    });

    // Course Summary Modal Functionality
    const questButtons = document.querySelectorAll('.quest-button');
    const courseSummaryModal = document.getElementById('courseSummaryModal');
    const closeSummaryModal = document.getElementById('closeSummaryModal');
    const backToDashboardBtn = document.getElementById('backToDashboardBtn');
    const continueToLessonBtn = document.getElementById('continueToLessonBtn');
    const courseSummaryTitle = document.getElementById('courseSummaryTitle');
    const courseSummaryContent = document.getElementById('courseSummaryContent');
    const courseSummaryHeader = document.getElementById('courseSummaryHeader');
    const courseSummaryProgress = document.getElementById('courseSummaryProgress');
    const courseSummaryProgressBar = document.getElementById('courseSummaryProgressBar');
    const courseLearningPoints = document.getElementById('courseLearningPoints');
    const courseEstimatedTime = document.getElementById('courseEstimatedTime');
    
    // Course content data
    const courseData = {
        english: {
            title: "Literary Analysis: The Hero's Journey",
            description: "Learn how to analyze the hero's journey across different literary works and identify common patterns in storytelling.",
            headerClass: "english-bg",
            progressBarClass: "english-progress",
            progress: "75%",
            learningPoints: [
                "Understand the stages of the hero's journey",
                "Identify character archetypes in literature",
                "Analyze how the hero's journey applies to modern stories",
                "Develop critical reading skills for literary analysis"
            ],
            estimatedTime: "45 minutes",
            pageUrl: "Subjects/english.html"
        },
        filipino: {
            title: "Panitikang Pilipino: Noli Me Tangere",
            description: "Pag-aaral ng pambansang nobela ni Jose Rizal at ang kahulugan nito sa ating kasaysayan at lipunan.",
            headerClass: "filipino-bg",
            progressBarClass: "filipino-progress",
            progress: "60%",
            learningPoints: [
                "Kilalanin ang mahahalagang tauhan sa nobela",
                "Suriin ang mga pangunahing tema ng Noli Me Tangere",
                "Unawain ang kahulugan ng nobela sa konteksto ng kasaysayan ng Pilipinas",
                "Tuklasin ang mga simbolismo at metapora na ginamit ni Rizal"
            ],
            estimatedTime: "50 minutes",
            pageUrl: "Subjects/filipino.html"
        },
        science: {
            title: "Earth Science: Plate Tectonics",
            description: "Learn about how the Earth's crust is divided into tectonic plates and how their movements shape our planet's geography and create natural phenomena.",
            headerClass: "science-bg",
            progressBarClass: "science-progress",
            progress: "82%",
            learningPoints: [
                "Understand the theory of plate tectonics",
                "Identify different types of plate boundaries",
                "Explain how earthquakes, volcanoes, and mountain formation relate to plate movements",
                "Analyze real-world examples of tectonic activity"
            ],
            estimatedTime: "40 minutes",
            pageUrl: "Subjects/science.html"
        },
        math: {
            title: "Algebra: Quadratic Equations",
            description: "Master solving quadratic equations using different methods including factoring, completing the square, and the quadratic formula.",
            headerClass: "math-bg",
            progressBarClass: "math-progress",
            progress: "45%",
            learningPoints: [
                "Understand the standard form of quadratic equations",
                "Solve quadratic equations by factoring",
                "Apply the quadratic formula to solve equations",
                "Interpret solutions in real-world contexts"
            ],
            estimatedTime: "55 minutes",
            pageUrl: "Subjects/math.html"
        }
    };
    
    // Open course summary modal when quest button is clicked
    questButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            const subject = this.getAttribute('data-subject');
            const data = courseData[subject];
            
            if (data) {
                // Update modal content
                courseSummaryTitle.textContent = data.title;
                courseSummaryContent.innerHTML = `<p>${data.description}</p>`;
                courseSummaryHeader.className = 'modal-header ' + data.headerClass;
                courseSummaryProgress.textContent = data.progress;
                courseSummaryProgressBar.className = 'progress-fill ' + data.progressBarClass;
                courseSummaryProgressBar.style.width = data.progress;
                courseEstimatedTime.textContent = data.estimatedTime;
                
                // Update learning points
                let learningPointsHTML = '';
                data.learningPoints.forEach(point => {
                    learningPointsHTML += `<li>${point}</li>`;
                });
                courseLearningPoints.innerHTML = learningPointsHTML;
                
                // Set continue button destination
                continueToLessonBtn.setAttribute('data-destination', data.pageUrl);
                
                // Show modal
                courseSummaryModal.classList.add('active');
            }
        });
    });
    
    // Close modal when close button is clicked
    closeSummaryModal.addEventListener('click', function() {
        courseSummaryModal.classList.remove('active');
    });
    
    // Close modal when "Back to Dashboard" is clicked
    backToDashboardBtn.addEventListener('click', function() {
        courseSummaryModal.classList.remove('active');
    });
    
    // Redirect to lesson page when "Continue to Lesson" is clicked
    continueToLessonBtn.addEventListener('click', function() {
        const destination = this.getAttribute('data-destination');
        if (destination) {
            window.location.href = destination;
        }
        courseSummaryModal.classList.remove('active');
    });
    
    // Close modal when clicking outside
    courseSummaryModal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
        }
    });
    
    // Initialize reusable chatbot
    initReusableChatbot();
});
    
    // Reusable Chatbot initialization
    function initReusableChatbot() {
        // Create a chatbot instance for the main page if it doesn't exist
        if (!document.querySelector('#chatbotContainer')) {
            createChatbot('main', document.body);
        }
        
        // Example chatbot suggestions for different contexts
        const chatbotSuggestions = {
            main: [
                "How do I earn XP?",
                "What are achievements?",
                "How do I change accessibility settings?",
                "How do learning quests work?",
                "What rewards can I earn?",
                "Tell me a study tip",
                "How do I track my progress?"
            ],
            english: [
                "Explain the hero's journey",
                "What are character archetypes?",
                "Help with literary analysis",
                "How do I identify themes in a story?",
                "What are literary devices?",
                "Tips for writing essays",
                "How to analyze character development"
            ],
            filipino: [
                "Who are the main characters in Noli Me Tangere?",
                "What are the main themes of the novel?",
                "Tell me about Jose Rizal",
                "What is the historical context of Noli Me Tangere?",
                "Explain Filipino literary traditions",
                "Help with Filipino grammar",
                "Tips for writing in Filipino"
            ],
            science: [
                "Explain convergent boundaries",
                "What causes earthquakes?",
                "How do mountains form?",
                "What is the difference between weather and climate?",
                "How do volcanoes work?",
                "Explain the rock cycle",
                "What evidence supports plate tectonics?"
            ],
            math: [
                "How do I factor a quadratic equation?",
                "Explain the quadratic formula",
                "When do I use completing the square?",
                "What are the steps to solve word problems?",
                "Help with graphing quadratic functions",
                "Explain discriminants",
                "How to find x-intercepts"
            ]
        };
        
        // Create global function to instantiate chatbots on subject pages
        window.createSubjectChatbot = function(subjectName, container) {
            createChatbot(subjectName, container, chatbotSuggestions[subjectName]);
        };
    }
    
    // Function to create a chatbot instance
    function createChatbot(contextName, container, customSuggestions = null) {
        // Clone the template
        const template = document.getElementById('chatbotTemplate');
        const chatbotClone = document.importNode(template.content, true);
        
        // Add unique ID to the container
        const chatbotContainer = chatbotClone.querySelector('.chatbot-container');
        chatbotContainer.id = 'chatbot-' + contextName;
        
        // Get elements
        const chatbotToggle = chatbotClone.querySelector('.chatbot-toggle');
        const chatbotWindow = chatbotClone.querySelector('.chatbot-window');
        const chatbotClose = chatbotClone.querySelector('.chatbot-close');
        const chatbotMessages = chatbotClone.querySelector('.chatbot-messages');
        const chatbotSuggestions = chatbotClone.querySelector('.chatbot-suggestions');
        const chatbotInput = chatbotClone.querySelector('.chatbot-input');
        const chatbotSend = chatbotClone.querySelector('.chatbot-send');
        
        // Set context-specific welcome message
        let welcomeMessage = "Hello! How can I help you with your learning journey today?";
        if (contextName !== 'main') {
            welcomeMessage = `Hello! I'm here to help you with your ${contextName} lesson. What would you like to know?`;
        }
        chatbotMessages.querySelector('.bot-message').textContent = welcomeMessage;
        
        // Add toggle functionality
        chatbotToggle.addEventListener('click', () => {
            chatbotWindow.classList.toggle('hidden');
            if (!chatbotWindow.classList.contains('hidden')) {
                populateSuggestions(chatbotSuggestions, contextName, customSuggestions);
                chatbotInput.focus();
            }
        });
        
        // Add close functionality
        chatbotClose.addEventListener('click', () => {
            chatbotWindow.classList.add('hidden');
        });
        
        // Add input functionality
        chatbotInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && chatbotInput.value.trim() !== '') {
                handleUserInput(chatbotInput.value.trim());
            }
        });
        
        chatbotSend.addEventListener('click', () => {
            if (chatbotInput.value.trim() !== '') {
                handleUserInput(chatbotInput.value.trim());
            }
        });
        
        // Handle user input
        function handleUserInput(text) {
            // Add user message
            addChatMessage(chatbotMessages, text, 'user');
            
            // Clear input
            chatbotInput.value = '';
            
            // Generate response
            setTimeout(() => {
                const response = generateResponse(text, contextName);
                addChatMessage(chatbotMessages, response, 'bot');
                
                // Maybe suggest follow-up questions
                setTimeout(() => {
                    suggestFollowUp(text, contextName);
                }, 500);
            }, 600);
        }
        
        // Suggest follow-up questions
        function suggestFollowUp(userInput, context) {
            let followUpSuggestions = [];
            
            const lowerInput = userInput.toLowerCase();
            
            // General follow-ups based on context
            if (context === 'main') {
                if (lowerInput.includes('xp') || lowerInput.includes('points')) {
                    followUpSuggestions = [
                        "How do I level up faster?",
                        "What are XP streaks?",
                        "What can I do with XP?"
                    ];
                } else if (lowerInput.includes('achievement') || lowerInput.includes('badge')) {
                    followUpSuggestions = [
                        "How many achievements are there?",
                        "What's the rarest achievement?",
                        "Do achievements give rewards?"
                    ];
                }
            } else if (context === 'english') {
                if (lowerInput.includes('hero') || lowerInput.includes('journey')) {
                    followUpSuggestions = [
                        "What is the call to adventure?",
                        "Explain the mentor archetype",
                        "What is the atonement stage?"
                    ];
                } else if (lowerInput.includes('theme') || lowerInput.includes('analysis')) {
                    followUpSuggestions = [
                        "How to identify symbolism",
                        "What is foreshadowing?",
                        "Explain imagery in literature"
                    ];
                }
            } else if (context === 'math') {
                if (lowerInput.includes('quadratic') || lowerInput.includes('equation')) {
                    followUpSuggestions = [
                        "When is a quadratic unsolvable?",
                        "What are complex solutions?",
                        "How to find axis of symmetry?"
                    ];
                }
            }
            
            // If we have follow-ups, show them
            if (followUpSuggestions.length > 0) {
                // Clear current suggestions
                chatbotSuggestions.innerHTML = '';
                
                // Add new suggestions with "Related:" label
                const relatedLabel = document.createElement('div');
                relatedLabel.style.width = '100%';
                relatedLabel.style.fontSize = '0.8rem';
                relatedLabel.style.opacity = '0.7';
                relatedLabel.style.marginBottom = '5px';
                relatedLabel.textContent = 'Related questions:';
                chatbotSuggestions.appendChild(relatedLabel);
                
                followUpSuggestions.forEach(text => {
                    const suggestionBtn = document.createElement('button');
                    suggestionBtn.classList.add('suggestion-btn');
                    suggestionBtn.textContent = text;
                    
                    suggestionBtn.addEventListener('click', () => {
                        handleUserInput(text);
                    });
                    
                    chatbotSuggestions.appendChild(suggestionBtn);
                });
            }
        }
        
        // Append the chatbot to the container
        container.appendChild(chatbotClone);
        
        // Function to populate suggestions based on context
        function populateSuggestions(suggestionsContainer, context, customList = null) {
            suggestionsContainer.innerHTML = ''; // Clear existing suggestions
            
            // Use custom suggestions if provided, otherwise use defaults
            const suggestions = customList || [
                "How do I earn XP?",
                "What are achievements?",
                "How do I change accessibility settings?"
            ];
            
            suggestions.forEach(text => {
                const suggestionBtn = document.createElement('button');
                suggestionBtn.classList.add('suggestion-btn');
                suggestionBtn.textContent = text;
                
                suggestionBtn.addEventListener('click', () => {
                    handleUserInput(text);
                });
                
                suggestionsContainer.appendChild(suggestionBtn);
            });
        }
        
        // Return chatbot elements for potential external manipulation
        return {
            container: chatbotContainer,
            toggle: chatbotToggle,
            window: chatbotWindow,
            messages: chatbotMessages,
            suggestions: chatbotSuggestions
        };
    }
    
    // Function to add a message to the chat
    function addChatMessage(messagesContainer, text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', sender === 'bot' ? 'bot-message' : 'user-message');
        messageDiv.textContent = text;
        messagesContainer.appendChild(messageDiv);
        // Scroll to the bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Function to generate responses
    function generateResponse(text, context) {
        const lowerText = text.toLowerCase();
        
        // Common responses across all contexts
        if (lowerText.includes('hello') || lowerText.includes('hi ') || lowerText === 'hi') {
            return "Hello there! How can I help you today?";
        } else if (lowerText.includes('thank')) {
            return "You're welcome! Is there anything else you'd like to know?";
        } else if (lowerText.includes('bye') || lowerText.includes('goodbye')) {
            return "Goodbye! Come back anytime you need help with your learning journey!";
        } else if (lowerText.includes('xp') || lowerText.includes('experience points')) {
            return "You earn XP (Experience Points) by completing lessons, quizzes, and activities. The more challenging the activity, the more XP you earn! You can use XP to level up and unlock new content and achievements.";
        } else if (lowerText.includes('achievements') || lowerText.includes('badges')) {
            return "Achievements are special rewards you earn for completing specific goals or milestones in your learning journey. They include badges for perfect quiz scores, completing lesson streaks, and mastering topics. Check the Achievements section to see what you've unlocked!";
        } else if (lowerText.includes('accessibility')) {
            return "You can change accessibility settings by clicking the accessibility icon in the header. Options include text-to-speech, dyslexia-friendly font, color blind mode, high contrast mode, and focus mode for ADHD.";
        } else if (lowerText.includes('learn') && lowerText.includes('quest')) {
            return "Learning quests are structured learning paths designed like game missions. Each quest has specific learning objectives, activities, and rewards. Complete quests to earn XP, coins, and achievements while mastering new knowledge!";
        } else if (lowerText.includes('rewards')) {
            return "You can earn various rewards like XP points, coins, achievement badges, and unlock special content. Coins can be used to customize your avatar and unlock special learning resources.";
        } else if (lowerText.includes('study tip')) {
            const tips = [
                "Try the Pomodoro technique: study for 25 minutes, then take a 5-minute break.",
                "Teaching others what you've learned helps solidify your understanding.",
                "Regular review sessions are more effective than cramming the night before.",
                "Create mind maps to visualize connections between concepts.",
                "Study in different locations to improve memory retention.",
                "Take handwritten notes rather than typing for better recall.",
                "Use spaced repetition to review material at optimal intervals."
            ];
            return tips[Math.floor(Math.random() * tips.length)];
        } else if (lowerText.includes('track') && lowerText.includes('progress')) {
            return "You can track your progress on the dashboard. It shows your XP, level, completed quests, and achievements. Each subject card also displays your progress percentage for current quests.";
        }
        
        // Context-specific responses
        if (context === 'english') {
            if (lowerText.includes("hero's journey") || lowerText.includes("hero journey")) {
                return "The Hero's Journey is a narrative pattern identified by Joseph Campbell. It consists of stages including the Call to Adventure, Meeting the Mentor, Crossing the Threshold, Tests/Allies/Enemies, Approaching the Innermost Cave, Ordeal, Reward, Road Back, Resurrection, and Return with the Elixir. This pattern appears in countless stories across cultures and time periods.";
            } else if (lowerText.includes("character archetypes")) {
                return "Character archetypes are recurring character types found across literature. Common archetypes include the Hero, Mentor, Threshold Guardian, Herald, Shapeshifter, Shadow, Ally, and Trickster. Each serves a specific purpose in the narrative and represents universal human traits.";
            } else if (lowerText.includes("literary analysis")) {
                return "Literary analysis involves examining elements like plot, character, setting, point of view, symbolism, theme, and style to interpret a text's deeper meaning. It's about looking beyond the surface of what happens to understand why it happens and what it represents.";
            } else if (lowerText.includes("theme")) {
                return "To identify themes in a story, look for recurring ideas, concepts, or questions raised by the text. Analyze character development, conflicts, symbols, and how these elements connect to larger universal concepts like love, power, identity, or mortality.";
            } else if (lowerText.includes("literary device")) {
                return "Literary devices are techniques authors use to convey meaning and enhance their writing. Common examples include metaphor, simile, personification, foreshadowing, irony, symbolism, allegory, and imagery. These tools help create deeper layers of meaning in texts.";
            }
        } else if (context === 'math') {
            if (lowerText.includes("factor") && lowerText.includes("quadratic")) {
                return "To factor a quadratic equation (ax² + bx + c = 0): 1) Find two numbers that multiply to give ac and add up to b. 2) Rewrite the middle term using these numbers. 3) Group the terms and factor out common factors. For example, x² + 5x + 6 can be factored as (x + 2)(x + 3).";
            } else if (lowerText.includes("quadratic formula")) {
                return "The quadratic formula is x = (-b ± √(b² - 4ac)) / 2a for any quadratic equation in the form ax² + bx + c = 0. It gives you all solutions, including complex ones when the discriminant (b² - 4ac) is negative.";
            } else if (lowerText.includes("completing the square")) {
                return "Completing the square is used when you need to rewrite a quadratic expression in the form a(x - h)² + k. Steps: 1) Factor out any coefficient of x². 2) Group the x² and x terms. 3) Add and subtract the square of half the x coefficient. 4) Rewrite as a perfect square plus a constant.";
            }
        } else if (context === 'filipino') {
            if (lowerText.includes("noli me tangere") && lowerText.includes("character")) {
                return "Ang mga pangunahing tauhan sa Noli Me Tangere ay sina Crisostomo Ibarra, Maria Clara, Padre Damaso, Elias, Pilosopo Tasio, Sisa, at Kapitan Tiago. Bawat tauhan ay kumakatawan sa mga aspeto ng lipunang Pilipino noong panahon ng Espanyol.";
            } else if (lowerText.includes("rizal")) {
                return "Si Jose Rizal ay isang bayani ng Pilipinas, isang manunulat, doktor, at intelektuwal. Ipinanganak siya noong Hunyo 19, 1861 sa Calamba, Laguna. Sumulat siya ng mga nobelang Noli Me Tangere at El Filibusterismo na naglantad sa mga pang-aabuso ng pamahalaang Espanyol sa Pilipinas. Siya ay binaril sa Bagumbayan (ngayon ay Luneta) noong Disyembre 30, 1896.";
            } else if (lowerText.includes("tema") || lowerText.includes("noli me tangere") && lowerText.includes("tema")) {
                return "Ang mga pangunahing tema ng Noli Me Tangere ay kabilang ang: kolonyalismo at pang-aapi, pagkakaiba ng mga uri sa lipunan, kapangyarihan at katiwalian ng simbahan, edukasyon at kaliwanagan, pagmamahal sa bayan, at katarungan at paghihiganti.";
            }
        } else if (context === 'science') {
            if (lowerText.includes("convergent boundar")) {
                return "Convergent boundaries occur where tectonic plates move toward each other. When oceanic and continental plates converge, the denser oceanic plate subducts beneath the continental plate, creating features like trenches and volcanic mountains. When two continental plates converge, they form mountain ranges like the Himalayas.";
            } else if (lowerText.includes("earthquake")) {
                return "Earthquakes are caused by the sudden release of energy in the Earth's lithosphere, creating seismic waves. They typically occur along fault lines when tectonic plates suddenly slip past each other after building up stress. The point where the earthquake originates is called the hypocenter, while the point directly above it on the surface is the epicenter.";
            } else if (lowerText.includes("mountain") && lowerText.includes("form")) {
                return "Mountains form through several processes: 1) Tectonic plate collisions pushing land upward (fold mountains like the Himalayas), 2) Volcanic activity building up layers of material (volcanic mountains like Mt. Fuji), 3) Erosion of surrounding areas leaving resistant formations (residual mountains), and 4) Faulting, where blocks of crust move along faults (fault-block mountains like the Sierra Nevada).";
            }
        }
        
        // Default response if no specific match was found
        return "That's an interesting question about " + context + ". I'm still learning about that specific topic. Can you try asking something else, or rephrase your question?";
    }
    </script>

    <!-- Chatbot -->
    <div id="chatbotContainer">
        <div id="chatbotWindow" class="hidden">
            <div class="chatbot-header">
                <span>Chat Assistant</span>
                <button id="chatbotClose">&times;</button>
            </div>
            <div class="chatbot-messages">
                <div class="message bot-message">Hello! How can I help you with your learning journey today?</div>
            </div>
            <div class="chatbot-suggestions">
                <!-- Suggestions will be populated here -->
            </div>
        </div>
        <button id="chatbotToggle">
            <i class="fas fa-robot"></i>
        </button>
    </div>

    <!-- Floating Text-to-Speech Controls -->
    <button class="tts-toggle-btn" id="ttsToggleBtn" title="Toggle Text-to-Speech">
        <i class="fas fa-volume-up"></i>
    </button>
    
    <div class="tts-language-dropdown" id="ttsLanguageDropdown">
        <div class="tts-language-option active" data-lang="en-US">
            <i class="fas fa-language"></i>
            <span>English</span>
        </div>
        <div class="tts-language-option" data-lang="fil-PH">
            <i class="fas fa-language"></i>
            <span>Tagalog</span>
        </div>
        <div class="tts-language-option" data-lang="fil-en">
            <i class="fas fa-language"></i>
            <span>Taglish</span>
        </div>
    </div>
    
    <div class="tts-controls" id="ttsControls">
        <button class="tts-control-btn" id="ttsPauseBtn" title="Pause/Resume">
            <i class="fas fa-pause"></i>
        </button>
        <button class="tts-control-btn" id="ttsStopBtn" title="Stop">
            <i class="fas fa-stop"></i>
        </button>
        <button class="tts-control-btn" id="ttsLanguageBtn" title="Change Language">
            <i class="fas fa-globe"></i>
        </button>
    </div>
    
    <!-- Accessibility Modal -->
    <div class="accessibility-modal-overlay" id="accessibilityModal">
        <div class="accessibility-modal">
            <div class="accessibility-modal-header">
                <div class="accessibility-modal-title">
                    <i class="fas fa-universal-access"></i>
                    Accessibility Options
                </div>
                <div class="accessibility-modal-subtitle">Customize your learning experience for better accessibility</div>
            </div>
            <div class="accessibility-modal-content">
                <div class="option-section">
                    <div class="option-title">
                        <i class="fas fa-volume-up"></i>
                        Text-to-Speech
                    </div>
                    <p>Enable text reading in your preferred language. Click on text to hear it read aloud:</p>
                    <div class="tts-toggle-wrapper" style="margin-bottom: 10px; display: flex; align-items: center;">
                        <label class="switch" style="position: relative; display: inline-block; width: 60px; height: 30px; margin-right: 10px;">
                            <input type="checkbox" id="accessibilityTtsToggle" checked>
                            <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.2); transition: .4s; border-radius: 34px;"></span>
                        </label>
                        <span id="accessibilityTtsStatus">Text-to-Speech Enabled</span>
                    </div>
                    <div class="speech-options">
                        <div class="speech-option" data-lang="en-US">
                            <i class="fas fa-volume-up"></i>
                            <span>English</span>
                        </div>
                        <div class="speech-option" data-lang="fil-PH">
                            <i class="fas fa-volume-up"></i>
                            <span>Tagalog</span>
                        </div>
                        <div class="speech-option" data-lang="fil-en">
                            <i class="fas fa-volume-up"></i>
                            <span>Taglish</span>
                        </div>
                    </div>
                    <div class="text-speech-controls">
                        <button class="speech-control-btn" id="accessibilityPauseResumeBtn" title="Pause/Resume Speech">
                            <i class="fas fa-pause"></i>
                        </button>
                        <button class="speech-control-btn" id="accessibilityStopSpeechBtn" title="Stop Speech">
                            <i class="fas fa-stop"></i>
                        </button>
                        <span id="accessibilitySpeechVolumeControl">
                            <i class="fas fa-volume-up"></i>
                            <input type="range" min="0" max="1" step="0.1" value="1" id="accessibilityVolumeSlider">
                        </span>
                    </div>
                    <div class="speech-status" id="accessibilitySpeechStatus">
                        Select a language and click on any text to hear it
                    </div>
                    <div class="speech-demo-text" id="accessibilityDemoText">
                        Click here to test the text-to-speech in your selected language. This example will be read aloud.
                    </div>
                </div>
                
                <div class="option-section">
                    <div class="option-title">
                        <i class="fas fa-user-cog"></i>
                        Display & Interface Options
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-option" title="Uses a dyslexia-friendly font and improved spacing to make text easier to read">
                            <input type="checkbox" class="checkbox-input" id="accessibilityDyslexiaOption">
                            <span class="checkbox-label">Dyslexia Support</span>
                            <div class="option-description">Uses special fonts and spacing to make text easier to read</div>
                        </label>
                        <label class="checkbox-option" title="Highlights content you're focusing on and reduces distractions">
                            <input type="checkbox" class="checkbox-input" id="accessibilityAdhOption">
                            <span class="checkbox-label">ADHD Focus Mode</span>
                            <div class="option-description">Reduces distractions and highlights what you're focusing on</div>
                        </label>
                        <label class="checkbox-option" title="Changes color schemes to be distinguishable for different types of color blindness">
                            <input type="checkbox" class="checkbox-input" id="accessibilityColorBlindOption">
                            <span class="checkbox-label">Color Blind Friendly</span>
                            <div class="option-description">Adjusts colors to be more distinguishable</div>
                        </label>
                        <label class="checkbox-option" title="Increases contrast between text and background">
                            <input type="checkbox" class="checkbox-input" id="accessibilityHighContrastOption">
                            <span class="checkbox-label">High Contrast</span>
                            <div class="option-description">Makes text and backgrounds more distinct</div>
                        </label>
                        <label class="checkbox-option" title="Reduces animations and optimizes content for slower internet connections">
                            <input type="checkbox" class="checkbox-input" id="accessibilitySlowConnectionOption">
                            <span class="checkbox-label">Low Bandwidth Mode</span>
                            <div class="option-description">Optimizes for slower internet connections</div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="accessibility-modal-footer">
                <button class="modal-btn btn-secondary" id="accessibilityCloseBtn">Close</button>
                <button class="modal-btn btn-primary" id="accessibilityApplyBtn">Apply Changes</button>
            </div>
        </div>
    </div>

    <!-- Course Summary Modal -->
    <div class="modal-overlay" id="courseSummaryModal">
        <div class="modal">
            <div class="modal-header" id="courseSummaryHeader">
                <div class="modal-title" id="courseSummaryTitle">Course Summary</div>
                <button class="close-modal" id="closeSummaryModal">&times;</button>
            </div>
            <div class="modal-content">
                <div id="courseSummaryContent">
                    <!-- Content will be dynamically inserted here -->
                </div>
                <div class="progress-section" style="margin-top: 20px;">
                    <div class="progress-info">
                        <span>Course Progress</span>
                        <span id="courseSummaryProgress">75%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="courseSummaryProgressBar" style="width: 75%"></div>
                    </div>
                </div>
                <div class="course-overview" style="margin-top: 25px;">
                    <h3>What you'll learn</h3>
                    <ul id="courseLearningPoints">
                        <!-- Learning points will be dynamically inserted here -->
                    </ul>
                </div>
                <div class="estimated-time" style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-clock" style="color: var(--accent);"></i>
                    <span>Estimated time to complete: <strong id="courseEstimatedTime">45 minutes</strong></span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn btn-secondary" id="backToDashboardBtn">Back to Dashboard</button>
                <button class="modal-btn btn-primary" id="continueToLessonBtn">Continue to Lesson</button>
            </div>
        </div>
    </div>

    <!-- Reusable Chatbot Template -->
    <template id="chatbotTemplate">
        <div class="chatbot-container">
            <div class="chatbot-window hidden">
                <div class="chatbot-header">
                    <span class="chatbot-title">Chat Assistant</span>
                    <button class="chatbot-close">&times;</button>
                </div>
                <div class="chatbot-messages">
                    <div class="message bot-message">Hello! How can I help you with your learning journey today?</div>
                </div>
                <div class="chatbot-input-container">
                    <input type="text" class="chatbot-input" placeholder="Type your question here...">
                    <button class="chatbot-send">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="chatbot-suggestions">
                    <!-- Suggestions will be populated here -->
                </div>
            </div>
            <button class="chatbot-toggle">
                <i class="fas fa-robot"></i>
            </button>
        </div>
    </template>
</body>
</html>

<script>
// Initialize accessibility modal
document.addEventListener('DOMContentLoaded', function() {
    const accessibilityToggle = document.getElementById('accessibilityToggle');
    const accessibilityModal = document.getElementById('accessibilityModal');
    const accessibilityCloseBtn = document.getElementById('accessibilityCloseBtn');
    const accessibilityApplyBtn = document.getElementById('accessibilityApplyBtn');
    
    // Accessibility options
    const accessibilityDyslexiaOption = document.getElementById('accessibilityDyslexiaOption');
    const accessibilityAdhOption = document.getElementById('accessibilityAdhOption');
    const accessibilityColorBlindOption = document.getElementById('accessibilityColorBlindOption');
    const accessibilityHighContrastOption = document.getElementById('accessibilityHighContrastOption');
    const accessibilitySlowConnectionOption = document.getElementById('accessibilitySlowConnectionOption');
    
    // TTS controls
    const accessibilityTtsToggle = document.getElementById('accessibilityTtsToggle');
    const accessibilityTtsStatus = document.getElementById('accessibilityTtsStatus');
    const accessibilityPauseResumeBtn = document.getElementById('accessibilityPauseResumeBtn');
    const accessibilityStopSpeechBtn = document.getElementById('accessibilityStopSpeechBtn');
    const accessibilityVolumeSlider = document.getElementById('accessibilityVolumeSlider');
    const accessibilitySpeechOptions = document.querySelectorAll('.accessibility-modal-content .speech-option');
    const accessibilityDemoText = document.getElementById('accessibilityDemoText');
    
    // Initialize options from localStorage
    if (localStorage.getItem('dyslexiaFriendly') === 'true') {
        accessibilityDyslexiaOption.checked = true;
        document.body.classList.add('dyslexia-friendly');
    }
    
    if (localStorage.getItem('focusMode') === 'true') {
        accessibilityAdhOption.checked = true;
        document.body.classList.add('focus-mode');
    }
    
    if (localStorage.getItem('colorBlindFriendly') === 'true') {
        accessibilityColorBlindOption.checked = true;
        document.body.classList.add('color-blind-friendly');
    }
    
    if (localStorage.getItem('highContrast') === 'true') {
        accessibilityHighContrastOption.checked = true;
        document.body.classList.add('high-contrast');
    }
    
    if (localStorage.getItem('slowConnection') === 'true') {
        accessibilitySlowConnectionOption.checked = true;
        document.body.classList.add('slow-connection');
    }
    
    // Initialize TTS settings
    const ttsEnabled = localStorage.getItem('textToSpeechEnabled');
    if (ttsEnabled !== null) {
        accessibilityTtsToggle.checked = ttsEnabled === 'true';
        accessibilityTtsStatus.textContent = ttsEnabled === 'true' ? 'Text-to-Speech Enabled' : 'Text-to-Speech Disabled';
    }
    
    // Get active language from localStorage
    const savedLang = localStorage.getItem('textToSpeechLanguage');
    if (savedLang) {
        accessibilitySpeechOptions.forEach(option => {
            if (option.getAttribute('data-lang') === savedLang) {
                option.classList.add('active');
            }
        });
    }
    
    // Sync volume slider with stored value
    const savedVolume = localStorage.getItem('ttsVolume');
    if (savedVolume) {
        accessibilityVolumeSlider.value = savedVolume;
    }
    
    // Toggle modal
    accessibilityToggle.addEventListener('click', function() {
        accessibilityModal.classList.add('active');
    });
    
    // Close modal
    accessibilityCloseBtn.addEventListener('click', function() {
        accessibilityModal.classList.remove('active');
    });
    
    // Apply changes
    accessibilityApplyBtn.addEventListener('click', function() {
        // Save TTS settings
        const ttsEnabled = accessibilityTtsToggle.checked;
        localStorage.setItem('textToSpeechEnabled', ttsEnabled ? 'true' : 'false');
        
        // Get active language
        const activeLangOption = document.querySelector('.accessibility-modal-content .speech-option.active');
        if (activeLangOption) {
            localStorage.setItem('textToSpeechLanguage', activeLangOption.getAttribute('data-lang'));
        }
        
        // Save volume
        localStorage.setItem('ttsVolume', accessibilityVolumeSlider.value);
        
        // Update floating TTS button
        const ttsToggleBtn = document.getElementById('ttsToggleBtn');
        if (ttsToggleBtn) {
            ttsToggleBtn.classList.toggle('active', ttsEnabled);
        }
        
        // Show/hide controls
        const ttsControls = document.getElementById('ttsControls');
        if (ttsControls) {
            ttsControls.classList.toggle('show', ttsEnabled);
        }
        
        // Welcome modal TTS toggle
        const welcomeTtsToggle = document.getElementById('ttsEnabledToggle');
        if (welcomeTtsToggle) {
            welcomeTtsToggle.checked = ttsEnabled;
            const welcomeTtsStatus = document.getElementById('ttsToggleStatus');
            if (welcomeTtsStatus) {
                welcomeTtsStatus.textContent = ttsEnabled ? 'Text-to-Speech Enabled' : 'Text-to-Speech Disabled';
            }
        }
        
        // Apply display options
        document.body.classList.toggle('dyslexia-friendly', accessibilityDyslexiaOption.checked);
        localStorage.setItem('dyslexiaFriendly', accessibilityDyslexiaOption.checked ? 'true' : 'false');
        
        document.body.classList.toggle('focus-mode', accessibilityAdhOption.checked);
        localStorage.setItem('focusMode', accessibilityAdhOption.checked ? 'true' : 'false');
        
        document.body.classList.toggle('color-blind-friendly', accessibilityColorBlindOption.checked);
        localStorage.setItem('colorBlindFriendly', accessibilityColorBlindOption.checked ? 'true' : 'false');
        
        document.body.classList.toggle('high-contrast', accessibilityHighContrastOption.checked);
        localStorage.setItem('highContrast', accessibilityHighContrastOption.checked ? 'true' : 'false');
        
        document.body.classList.toggle('slow-connection', accessibilitySlowConnectionOption.checked);
        localStorage.setItem('slowConnection', accessibilitySlowConnectionOption.checked ? 'true' : 'false');
        
        // If slow connection is enabled, simulate loading
        if (accessibilitySlowConnectionOption.checked) {
            simulateSlowLoading();
        }
        
        // Update speech element clickability
        enableTextToSpeechForContentElements();
        
        // Close modal
        accessibilityModal.classList.remove('active');
    });
    
    // TTS toggle
    accessibilityTtsToggle.addEventListener('change', function() {
        const isEnabled = this.checked;
        accessibilityTtsStatus.textContent = isEnabled ? 'Text-to-Speech Enabled' : 'Text-to-Speech Disabled';
    });
    
    // Language selection
    accessibilitySpeechOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Reset active options
            accessibilitySpeechOptions.forEach(opt => opt.classList.remove('active'));
            // Set new active option
            this.classList.add('active');
            
            // Demo the selected language if TTS is enabled
            if (accessibilityTtsToggle.checked) {
                const lang = this.getAttribute('data-lang');
                let demoPhrase = "This is a test of the text-to-speech feature.";
                if (lang === "fil-PH") {
                    demoPhrase = "Ito ay isang pagsubok ng text-to-speech na feature.";
                } else if (lang === "fil-en") {
                    demoPhrase = "This is a test of the text-to-speech feature, salamat po!";
                }
                
                if (window.speakText) {
                    window.speakText(demoPhrase, lang);
                }
            }
        });
    });
    
    // Demo text click handler
    if (accessibilityDemoText) {
        accessibilityDemoText.addEventListener('click', function() {
            if (!accessibilityTtsToggle.checked) {
                return; // Don't speak if TTS is disabled
            }
            
            const activeLangOption = document.querySelector('.accessibility-modal-content .speech-option.active');
            if (activeLangOption) {
                const lang = activeLangOption.getAttribute('data-lang');
                if (window.speakText) {
                    window.speakText(this.textContent, lang);
                }
            }
        });
    }
    
    // Pause/Resume button
    if (accessibilityPauseResumeBtn) {
        accessibilityPauseResumeBtn.addEventListener('click', function() {
            if ('speechSynthesis' in window) {
                if (window.speechSynthesis.speaking) {
                    if (window.speechSynthesis.paused) {
                        window.speechSynthesis.resume();
                        this.innerHTML = '<i class="fas fa-pause"></i>';
                    } else {
                        window.speechSynthesis.pause();
                        this.innerHTML = '<i class="fas fa-play"></i>';
                    }
                }
            }
        });
    }
    
    // Stop button
    if (accessibilityStopSpeechBtn) {
        accessibilityStopSpeechBtn.addEventListener('click', function() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
            }
        });
    }
    
    // Close on click outside
    accessibilityModal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
        }
    });
});

// Initialize user profile accessibility button
document.addEventListener('DOMContentLoaded', function() {
    // Get existing toggle
    const accessibilityToggle = document.getElementById('accessibilityToggle');
    const accessibilityModal = document.getElementById('accessibilityModal');
    
    // Add listener for the user profile accessibility button
    const userAccessibilityBtn = document.getElementById('userAccessibilityBtn');
    if (userAccessibilityBtn && accessibilityModal) {
        userAccessibilityBtn.addEventListener('click', function() {
            accessibilityModal.classList.add('active');
        });
    }
    
    // Rest of the initialization code...
});
</script>